"use strict";var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e=function(){var e,t,a,o,n,r,i,s,c,l,d,m,g={default:"default",UOSMode:"iku",MiniMode:"mini"};function u(){window.caches&&window.caches.keys&&window.caches.keys().then(function(e){e.forEach(function(e){caches.delete(e)})}),localStorage.removeItem("cachedTime")}function f(o){var n=!0;return o&&["android","ios"].forEach(function(e){var t,a=o[e];!a||"number"==typeof(t=function(e){var t=navigator.userAgent.toLowerCase(),a=null;switch(e){case"android":0<t.indexOf("android")&&(a=(t.match(/android [\d._]+/gi)+"").replace(/[^0-9|_.]/gi,"").replace(/_/gi,"."),a=parseInt(a.split(".")[0]));break;case"ios":0<t.indexOf("like mac os x")&&(a=(t.match(/os [\d._]+/gi)+"").replace(/[^0-9|_.]/gi,"").replace(/_/gi,"."),a=parseInt(a.split(".")[0]))}return a}(e))&&("string"==typeof a&&~a.indexOf("+")&&(e=parseInt(a.split("+")[0]),n=e<=t),Array.isArray(a)&&a.length&&(n=a.includes(String(t))))}),n}function p(t,a){var o=void 0;return Object.keys(g).forEach(function(e){e===a&&g[a]&&"object"===(void 0===t?"undefined":h(t))&&void 0!==t[g[a]]&&(o=t[g[a]])}),o||t}navigator.serviceWorker?(navigator.serviceWorker.addEventListener("message",function(e){try{var t=e&&e.data&&JSON.parse(e.data);t&&t.type&&"sw-error"===t.type&&console.info({alarm_type:t.type,alarm_code:101,client_msg:t.detail})}catch(e){}}),console.info({alarm_type:"sw-support",alarm_code:"success",client_msg:{message:"pwa is support"+location.href}}),o=navigator.userAgent,n="default",m="UOSMode",m=new RegExp("(^|&)"+m+"=([^&]*)(&|$)"),r=null!=(m=decodeURI(window.location.search.substr(1)).match(m))?unescape(m[2]):null,window.UOSMode=!(!o||!/UOSYouku/i.test(o))||void 0!==r&&"true"===String(r),n=window.UOSMode?"UOSMode":o&&/Youku-MINI/i.test(o)?"MiniMode":"default",e=window.pwa_config||{},l=n,r={switchConfig:"object"===(void 0===(d=p((c=e).pwaSwitch,l))?"undefined":h(d))?d&&d[location.hostname]:!!d,forceReload:p(c.forceReload,l),cacheMaxTime:p(c.cacheMaxTime,l)||2592e5,systemWhiteList:p(c.systemWhiteList,l)},t=r.switchConfig,a=r.forceReload,o=r.cacheMaxTime,n=r.systemWhiteList,r="sw.js",e&&Object.keys(e).length&&navigator.onLine&&(t&&f(n)?(function(){try{navigator.storage&&navigator.storage.estimate&&navigator.storage.estimate().then(function(e){e.quota-e.usage<1024&&u()})}catch(e){}}(),i=o,(s=localStorage.getItem("cachedTime"))&&+(new Date).getTime()-s>=i&&u(),navigator.serviceWorker.register("https://"+location.hostname+"/"+r,{scope:"/"}).then(function(e){localStorage.getItem("cachedTime")||localStorage.setItem("cachedTime",+(new Date).getTime()),console.info({alarm_type:"sw-ready",alarm_code:"success",client_msg:{message:"pwa is ready"+(new Date).getTime()}})}).catch(function(e){console.info({alarm_type:"sw-ready",alarm_code:"error",client_msg:{message:"pwa is not working!"+e.message}})})):navigator.serviceWorker.getRegistration("https://"+location.hostname+"/"+r).then(function(e){e&&e.unregister(),u(),console.info({alarm_type:"sw-clear-cache",alarm_code:8207,client_msg:{message:"pwa is cleared cache"+(new Date).getTime()}})}),navigator.serviceWorker.ready.then(function(e){var o;navigator.onLine&&!t&&(console.info({alarm_type:"sw-off",alarm_code:8206,client_msg:{message:"pwa is off"+(new Date).getTime()}}),o={pwaStrategy:t,forceReload:a},new Promise(function(t,a){var e=new MessageChannel;e.port1.onmessage=function(e){e.data.error?a(e.data.error):t(e.data)},navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage(o,[e.port2])}))}).catch(function(e){console.warn("navigator.serviceWorker is not ready!",e.message)}))):console.info({alarm_type:"sw-support",alarm_code:"error",client_msg:{message:"pwa is not support!"+location.href}})},t=document.getElementsByTagName("head")[0];try{var a=document.createElement("script");a.setAttribute("src","https://"+location.hostname+"/pwaSetting.js"),a.setAttribute("type","text/javascript"),a.async=!0,t.appendChild(a),a.onload=function(){e()},a.onerror=function(){}}catch(e){}