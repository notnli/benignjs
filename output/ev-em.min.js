/**
 * @license ev-em.js v3.2.22
 * (c) 2015-2019 Evolok, Inc. http://www.evolok.com/
 *
 * License: MIT
 */
window.EV=window.EV||{},function(t){"use strict";function n(){E&&o("ev_sid")!=E&&(i("ev_sid",E,10),c("ev_sid",E,0,"localStorage"),y=y+"&ev_sid="+E),S&&o("ev_did")!=S&&(i("ev_did",S,10),c("ev_did",S,0,"localStorage"),y=y+"&ev_did="+S)}function o(e){var t=document.cookie;t=t.split("; ");for(var n={},o=0;o<t.length;o++){var i=t[o].split("=");n[i[0]]=i[1]}return n[e]?n[e]:""}function i(e,t,n){if(!_.sidCookieDomain)throw new Error("Please specify sidCookieDomain in the config!",!0);var o=new Date;n=1460,o.setDate(o.getDate()+n),document.cookie=e+"="+escape(t)+(null===n?"":";expires="+o.toUTCString())+";path=/; domain="+_.sidCookieDomain,console.log(e+"="+escape(t)+(null===n?"":";expires="+o.toUTCString())+";path=/; domain="+_.sidCookieDomain)}function r(e){if(""!==o(e)&&"undefined"!==o(e))return o(e)}function s(e){if(""!==d(e,"localStorage")&&"undefined"!==d(e,"localStorage"))return d(e,"localStorage")}function a(){if(!_)throw"Evolok Metering library is not initialised!"}function d(e,t){var n=document.cookie.indexOf(e+"=");if("localStorage"==t){if("undefined"==typeof localStorage)return document.cookie.length>0&&-1!==n?getCookieSubstring(n,e):"";try{return localStorage.getItem(e)}catch(e){return console.warn("Could not retrieve the cookie in local storage - maybe the browser's running on an environment with restricted access to localStorage?"),"undefined"}}if("sessionStorage"==t){if("undefined"==typeof sessionStorage)return n=document.cookie.indexOf(e+"="),document.cookie.length>0&&-1!==n?getCookieSubstring(n,e):"";console.log(sessionStorage.getItem(e));try{return sessionStorage.getItem(e)}catch(e){return console.warn("Could not retrieve the cookie in session storage - maybe the browser's running on an environment with restricted access to sessionStorage?"),"undefined"}}}function c(e,t,n,o){var i=new Date;if("localStorage"==o)if(i.setDate(i.getDate()+n),"undefined"!=typeof localStorage)try{localStorage.setItem(e,t)}catch(e){console.warn("Could not store the cookie in local storage - maybe the browser's running on an environment with restricted access to localStorage?")}else document.cookie=e+"="+escape(t)+(null===n?"":";expires="+i.toUTCString());if("sessionStorage"==o)if(i.setDate(i.getDate()+n),"undefined"!=typeof sessionStorage)try{sessionStorage.setItem(e,t)}catch(e){console.warn("Could not store the cookie in session storage - maybe the browser's running on an environment with restricted access to sessionStorage?")}else document.cookie=e+"="+escape(t)+(null===n?"":";expires="+i.toUTCString())}function l(e){var t="";e=JSON.parse(e);for(var n in e)""!==t&&(t+="&"),t+=n+"="+encodeURIComponent(e[n]);return t}function u(e,t){a();var n=_.url;if(!n)throw new Error("Evolok Metering host url is not configured!");return"/"===n.charAt(n.length-1)&&"/"===e.charAt(0)?n+=e.substring(1,e.length):n+=e,n=t?n+"?"+t:n}function v(){var e=this;this.promise=new Promise(function(t,n){e.reject=n,e.resolve=t})}var f=new v,m=new v,g=!1,p=0,w=0,h={};window.addEventListener("ev.widgets.dwelltime.enabled",function(e){e.detail.dwellTimeTrackingEnabled&&(g=!0,w=e.detail.maxDwellTimeRequests||3,setTimeout(function(){t.Em.initDwellTimeRequests(h.authorizeData)},1e3))});var _,E,S,y,C;t.Em={init:function(e){if(!e.url)throw"Configuration must specify the url property!";e.hasOwnProperty("brand")&&(this.brand=e.brand),_=e},getAuthResponse:function(){return f.promise},getSegmentResponse:function(){return m.promise},authorize:function(e,n,a){t.Em.assert(e,"Parameters should not be empty!"),t.Em.assert(n,"Success callback should not be empty!"),t.Em.assert(a,"Error callback should not be empty!");var v=l(e),m="",p="",w="";y=v,-1===v.indexOf("referrer")&&document.referrer&&(v+="&referrer="+encodeURIComponent(document.referrer)),-1===v.indexOf("title")&&document.title&&(v+="&title="+encodeURIComponent(document.title)),-1===v.indexOf("article_url")&&window.location.href&&(v+="&article_url="+encodeURIComponent(window.location.href)),_.brand?v+="&brand="+encodeURIComponent(_.brand):e.site&&(v+="&brand="+encodeURIComponent(e.site)),r("ev_sid")?(p="&ev_sid="+o("ev_sid"),c("ev_sid",o("ev_sid"),0,"localStorage")):s("ev_sid")&&(_.meterHD?!0===_.meterHD&&(i("ev_sid",d("ev_sid","localStorage"),10),p="&ev_sid="+d("ev_sid","localStorage"),C=_.meterHD):i("ev_sid",d("ev_sid","localStorage"),10)),r("ev_did")?(w="&ev_did="+o("ev_did"),c("ev_did",o("ev_did"),0,"localStorage")):s("ev_did")&&(_.meterHD?!0===_.meterHD&&(i("ev_did",d("ev_did","localStorage"),10),w="&ev_did="+d("ev_did","localStorage")):i("ev_did",d("ev_did","localStorage"),10)),""!==o("ev_ss")&&(m+="&ev_ss="+o("ev_ss")),m=m==="&ev_ss="+o("ev_ss")?"&ev_ss="+o("ev_ss"):"&ev_ss=",p=p==="&ev_sid="+o("ev_sid")?"&ev_sid="+o("ev_sid"):"&ev_sid=",w=w==="&ev_did="+o("ev_did")?"&ev_did="+o("ev_did"):"&ev_did=",v=v+m+p+w;var b=u("/authorize/json",v),k=new XMLHttpRequest;k.open("GET",b,!0),k.withCredentials=!0,k.onload=function(){if(k.status>=200&&k.status<400){var e=JSON.parse(k.responseText);f.resolve(e),h.authorizeData=e,e.sessionKeys?(e.sessionKeys.ev_sid&&(E=e.sessionKeys.ev_sid),e.sessionKeys.ev_did&&(S=e.sessionKeys.ev_did,e.deviceId=e.sessionKeys.ev_did)):e.deviceId=o("ev_did"),t.Em.paywallAndNotifierEvents(e),"REQUIRE_LOGIN"===e.result&&(""!==o("ev_ss")&&t.Event.publish("session.cleanup","Session has expired"),t.Event.publish("login.required","Login is required")),"ALLOW_ACCESS"!=e.result&&t.Em.hideMeteredContent(),n(e)}else a&&a(k.status,k.responseText)},k.onerror=function(e){e?a(e):a(0,"unknown connection error")},k.send(),function(){if(!g){var e;"function"==typeof CustomEvent?e=new CustomEvent("ev.ad.dwelltime.check"):(e=document.createEvent("CustomEvent"),e.initCustomEvent("ev.ad.dwelltime.check",!1,!1,{})),window.dispatchEvent(e)}}()},initDwellTimeRequests:function(e){function n(e){return 30*e+30}var o=window.setInterval(function(){if(!document.hidden){var i=n(p);e.dwellTimeInterval=i,t.Em.paywallAndNotifierEvents(e),p++}p==w&&clearInterval(o)},3e4)},paywallAndNotifierEvents:function(e){function t(e){var t;"function"==typeof CustomEvent?t=new CustomEvent("ev.ad.authorize",{detail:e}):(t=document.createEvent("CustomEvent"),t.initCustomEvent("ev.ad.authorize",!1,!1,e)),window.dispatchEvent(t)}t(e),window.addEventListener("ev.widgets.paywall.load",function(){t(e)}),window.addEventListener("ev.widgets.notifier.load",function(){t(e)})},pretty_print:function(e){var n=/^( *)("[\w]+": )?("[^"]*"|[\w.+-]*)?([,[{])?$/gm,o=JSON.stringify(e,null,3).replace(/&/g,"&amp;").replace(/\\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(n,t.Em.replacer);return o="<pre>"+o+"</pre>"},replacer:function(e,t,n,o,i){var r=t||"";return n&&(r=r+"<span class=json-key>"+n.replace(/[": ]/g,"")+"</span>: "),o&&(r=r+('"'==o[0]?"<span class=json-string>":"<span class=json-value>")+o+"</span>"),r+(i||"")},segment:function(n,o,i){t.Em.assert(n,"Parameters should not be empty!"),t.Em.assert(o,"Success callback should not be empty!"),t.Em.assert(i,"Error callback should not be empty!");var r=l(n),s=u("/segment",r),a=new XMLHttpRequest;a.open("GET",s,!0),a.withCredentials=!0,a.onload=function(){if(a.status>=200&&a.status<400){var e=JSON.parse(a.responseText);m.resolve(e),o(e)}else i&&i(a.status,a.responseText)},a.onerror=function(){e?i(e):i(0,"unknown connection error")},a.send()},assert:function(e,t){if(!e){if(t=t||"Assertion failed","undefined"!=typeof Error)throw new Error(t);throw t}},getUrl:function(){return _.url},showMeteredContent:function(){var e=document.getElementsByClassName("ev-meter-content");[].forEach.call(e,function(e){e.style.display="block"})},hideMeteredContent:function(){var e=document.getElementsByClassName("ev-meter-content");[].forEach.call(e,function(e){e.style.display="none"})}},setTimeout(function(){n()},4e3)}(window.EV);