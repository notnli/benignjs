/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
(function defineMustache(b,a){if(typeof exports==="object"&&exports&&typeof exports.nodeName!=="string"){a(exports)}else{if(typeof define==="function"&&define.amd){define(["exports"],a)}else{b.Mustache={};a(b.Mustache)}}}(this,function mustacheFactory(F){var x=Object.prototype.toString;var y=Array.isArray||function d(Q){return x.call(Q)==="[object Array]"};function u(Q){return typeof Q==="function"}function L(Q){return y(Q)?"array":typeof Q}function i(Q){return Q.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function J(R,Q){return R!=null&&typeof R==="object"&&(Q in R)}var o=RegExp.prototype.test;function c(R,Q){return o.call(R,Q)}var s=/\S/;function E(Q){return !c(s,Q)}var q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function z(Q){return String(Q).replace(/[&<>"'`=\/]/g,function R(S){return q[S]})}var t=/\s*/;var C=/\s+/;var l=/\s*=/;var N=/\s*\}/;var r=/#|\^|\/|>|\{|&|=|!/;function e(aj,Y){if(!aj){return[]}var aa=[];var Z=[];var V=[];var ak=false;var ah=false;function ag(){if(ak&&!ah){while(V.length){delete Z[V.pop()]}}else{V=[]}ak=false;ah=false}var ac,X,ai;function W(al){if(typeof al==="string"){al=al.split(C,2)}if(!y(al)||al.length!==2){throw new Error("Invalid tags: "+al)}ac=new RegExp(i(al[0])+"\\s*");X=new RegExp("\\s*"+i(al[1]));ai=new RegExp("\\s*"+i("}"+al[1]))}W(Y||F.tags);var S=new a(aj);var T,R,ab,ae,U,Q;while(!S.eos()){T=S.pos;ab=S.scanUntil(ac);if(ab){for(var af=0,ad=ab.length;af<ad;++af){ae=ab.charAt(af);if(E(ae)){V.push(Z.length)}else{ah=true}Z.push(["text",ae,T,T+1]);T+=1;if(ae==="\n"){ag()}}}if(!S.scan(ac)){break}ak=true;R=S.scan(r)||"name";S.scan(t);if(R==="="){ab=S.scanUntil(l);S.scan(l);S.scanUntil(X)}else{if(R==="{"){ab=S.scanUntil(ai);S.scan(N);S.scanUntil(X);R="&"}else{ab=S.scanUntil(X)}}if(!S.scan(X)){throw new Error("Unclosed tag at "+S.pos)}U=[R,ab,T,S.pos];Z.push(U);if(R==="#"||R==="^"){aa.push(U)}else{if(R==="/"){Q=aa.pop();if(!Q){throw new Error('Unopened section "'+ab+'" at '+T)}if(Q[1]!==ab){throw new Error('Unclosed section "'+Q[1]+'" at '+T)}}else{if(R==="name"||R==="{"||R==="&"){ah=true}else{if(R==="="){W(ab)}}}}}Q=aa.pop();if(Q){throw new Error('Unclosed section "'+Q[1]+'" at '+S.pos)}return m(p(Z))}function p(V){var R=[];var T,Q;for(var S=0,U=V.length;S<U;++S){T=V[S];if(T){if(T[0]==="text"&&Q&&Q[0]==="text"){Q[1]+=T[1];Q[3]=T[3]}else{R.push(T);Q=T}}}return R}function m(V){var X=[];var U=X;var W=[];var R,T;for(var Q=0,S=V.length;Q<S;++Q){R=V[Q];switch(R[0]){case"#":case"^":U.push(R);W.push(R);U=R[4]=[];break;case"/":T=W.pop();T[5]=R[2];U=W.length>0?W[W.length-1][4]:X;break;default:U.push(R)}}return X}function a(Q){this.string=Q;this.tail=Q;this.pos=0}a.prototype.eos=function K(){return this.tail===""};a.prototype.scan=function O(S){var R=this.tail.match(S);if(!R||R.index!==0){return""}var Q=R[0];this.tail=this.tail.substring(Q.length);this.pos+=Q.length;return Q};a.prototype.scanUntil=function I(S){var R=this.tail.search(S),Q;switch(R){case -1:Q=this.tail;this.tail="";break;case 0:Q="";break;default:Q=this.tail.substring(0,R);this.tail=this.tail.substring(R)}this.pos+=Q.length;return Q};function M(R,Q){this.view=R;this.cache={".":this.view};this.parent=Q}M.prototype.push=function G(Q){return new M(Q,this)};M.prototype.lookup=function j(T){var R=this.cache;var V;if(R.hasOwnProperty(T)){V=R[T]}else{var U=this,W,S,Q=false;while(U){if(T.indexOf(".")>0){V=U.view;W=T.split(".");S=0;while(V!=null&&S<W.length){if(S===W.length-1){Q=J(V,W[S])}V=V[W[S++]]}}else{V=U.view[T];Q=J(U.view,T)}if(Q){break}U=U.parent}R[T]=V}if(u(V)){V=V.call(this.view)}return V};function k(){this.cache={}}k.prototype.clearCache=function A(){this.cache={}};k.prototype.parse=function v(S,R){var Q=this.cache;var T=Q[S];if(T==null){T=Q[S]=e(S,R)}return T};k.prototype.render=function B(T,Q,S){var U=this.parse(T);var R=(Q instanceof M)?Q:new M(Q);return this.renderTokens(U,R,S,T)};k.prototype.renderTokens=function n(X,Q,V,Z){var T="";var S,R,Y;for(var U=0,W=X.length;U<W;++U){Y=undefined;S=X[U];R=S[0];if(R==="#"){Y=this.renderSection(S,Q,V,Z)}else{if(R==="^"){Y=this.renderInverted(S,Q,V,Z)}else{if(R===">"){Y=this.renderPartial(S,Q,V,Z)}else{if(R==="&"){Y=this.unescapedValue(S,Q)}else{if(R==="name"){Y=this.escapedValue(S,Q)}else{if(R==="text"){Y=this.rawValue(S)}}}}}}if(Y!==undefined){T+=Y}}return T};k.prototype.renderSection=function w(S,Q,V,Y){var Z=this;var U="";var W=Q.lookup(S[1]);function R(aa){return Z.render(aa,Q,V)}if(!W){return}if(y(W)){for(var T=0,X=W.length;T<X;++T){U+=this.renderTokens(S[4],Q.push(W[T]),V,Y)}}else{if(typeof W==="object"||typeof W==="string"||typeof W==="number"){U+=this.renderTokens(S[4],Q.push(W),V,Y)}else{if(u(W)){if(typeof Y!=="string"){throw new Error("Cannot use higher-order sections without the original template")}W=W.call(Q.view,Y.slice(S[3],S[5]),R);if(W!=null){U+=W}}else{U+=this.renderTokens(S[4],Q,V,Y)}}}return U};k.prototype.renderInverted=function b(S,R,Q,U){var T=R.lookup(S[1]);if(!T||(y(T)&&T.length===0)){return this.renderTokens(S[4],R,Q,U)}};k.prototype.renderPartial=function H(S,R,Q){if(!Q){return}var T=u(Q)?Q(S[1]):Q[S[1]];if(T!=null){return this.renderTokens(this.parse(T),R,Q,T)}};k.prototype.unescapedValue=function g(R,Q){var S=Q.lookup(R[1]);if(S!=null){return S}};k.prototype.escapedValue=function D(R,Q){var S=Q.lookup(R[1]);if(S!=null){return F.escape(S)}};k.prototype.rawValue=function f(Q){return Q[1]};F.name="mustache.js";F.version="2.3.0";F.tags=["{{","}}"];var P=new k();F.clearCache=function A(){return P.clearCache()};F.parse=function v(R,Q){return P.parse(R,Q)};F.render=function B(S,Q,R){if(typeof S!=="string"){throw new TypeError('Invalid template! Template should be a "string" but "'+L(S)+'" was given as the first argument for mustache#render(template, view, partials)')}return P.render(S,Q,R)};F.to_html=function h(T,R,S,U){var Q=F.render(T,R,S);if(u(U)){U(Q)}else{return Q}};F.escape=z;F.Scanner=a;F.Context=M;F.Writer=k;return F}));b$.module("b$.view.preferences",function(){var c=b$.bdom.getNamespace("http://backbase.com/2012/view").getClass("displayElement");c.prototype.namespaceURI="http://backbase.com/2012/view";var d=c.extend(null,{localName:"PreferenceForm",getTemplate:function(){return'<div class="bp-pref-pane"><form class="bp-pref-form bp--form"><table class="bp-pref-table xbp-area"></table><div class="bp-userPreferencesForm-buttonsPannel"><button class="bp-userPreferencesForm-button bp-userPreferencesForm-okButton" onclick="try{var pf=b$.getVC(this);pf.save();pf.dispatchCustomEvent(\'close\');}catch(err){console.log(err)};return false;">ok</button><button class="bp-userPreferencesForm-button bp-userPreferencesForm-cancelButton" onclick="try{var pf=b$.getVC(this);pf.reset();pf.dispatchCustomEvent(\'close\');}catch(err){console.log(err)};return false;">cancel</button></div><div class="bp-userPreferencesForm-end"></div></form></div>';return'<form class="bp-userPreferencesForm bp-gradient1 bp-userPreferencesForm-active"><div class="bp-userPreferencesForm-fields bp-area"></div><div class="bp-userPreferencesForm-buttonsPannel"><button class="bp-userPreferencesForm-button bp-userPreferencesForm-okButton" onclick="var pf=b$.getVC(this);pf.save();pf.dispatchCustomEvent("close");return false;">ok</button><button class="bp-userPreferencesForm-button bp-userPreferencesForm-cancelButton" onclick="var pf=b$.getVC(this);pf.reset();pf.dispatchCustomEvent("close");return false;">cancel</button></div><div class="bp-userPreferencesForm-end"></div></form>'},getRowTemplate:function(){return'<tr class="xbp-userPreferenceField"><td class="bp-pref-td-label"><label class="bp-pref-label" for="{{name}}">{{label}}</label></td><td class="bp-pref-td-input"></td></tr>'},insertDisplayChild:function(e,i){var g={};if(e.model){g={name:e.model.name,label:(e.model.label)?e.model.label:e.model.name};var h=jQuery(Mustache.to_html(this.getRowTemplate(),g))[0];jQuery(".bp-pref-td-input",h).append(e.htmlNode)}else{var h=e.htmlNode}var f=b$._private.htmlAPI.findCaptureClass("portalManagerPreferenceFieldView",this.htmlNode)[0];f.appendChild(h)},createDisplay:function(e){if(e){}else{e=$(Mustache.to_html(this.getTemplate(),this.model.getJSON()))[0]}this.htmlNode=e;this.htmlNode.viewController=this;this.htmlBody=b$._private.htmlAPI.findCaptureClass("bp-pref-table",e)[0];return e},handlePrefModified:function(e){switch(e.attrChange){case 1:break;case 2:break;case 3:break}},connectToModel:function(){this.model.addEventListener("*",function(e){console.log("model "+e.type)});this.model.addEventListener("PrefModified",this.handlePrefModified)},disconnectFromModel:function(){this.model.removeEventListener("PrefModified",this.handlePrefModified)},reset:function(){console.log("reset")},buildFieldsFromPreferences:function(k,h){var j=b$.portal.controllers.preferences;this.map={};this.itemModel=h;for(var g=0,e=k.length;g<e;g++){var f=(typeof k[g]=="string")?this.ownerDocument.createFromString(k[g]):j.reflect(k[g],this.ownerDocument);if(f){this.appendChild(f);this.map[k[g].name]=f}else{console.log("Reflection error ",k[g])}}},save:function(){var e=this.childNodes;var g={};for(var f=0;f<e.length;f++){if(e[f].model){g[e[f].model.name]=e[f].ctrl.getValue(e[f])}}this.dispatchCustomEvent("savePreferenceForm",true,true,g)},cancel:function(){},hasChanges:function(){this.bChanged=false;b$.bdom.util.callFunctionRecursively(this,function(e){if(this.isInputField){if(this.value!=this.model.value){console.log(this);e.bChanged=true;console.log(this.value,this.model.value)}}},[this]);console.log("bChanged "+this.bChanged)}},{actions:{cancel:function(){},save:function(){}},handlers:{click:function(f){if(f.target==this){var e=this.getDisplayEventTarget(f.htmlTarget);if(e){var g=e.getAttribute("data-action");if(g){this.dispatchCustomEvent(g)}}}},save:function(e){this.save();this.dispatchCustomEvent("closePreferenceForm",true,true)},cancel:function(e){this.cancel();this.dispatchCustomEvent("closePreferenceForm",true,true)},xDOMNodeInsertedIntoDocument:function(e){},xDOMNodeInserted:function(e){},xvalidate:function(e){}}});var b=c.extend(null,{localName:"BaseControl",cnBasePrefix:"bc-",cnBase:"",buildJSON:function(){},doTemplate:function(){return"<div></div>"},buildHTML:function(){var e=jQuery(this.doTemplate(this.buildJSON()))[0];return e},getBoolAttribute:function(f){var e=this.getAttribute(f);if(e&&e!="false"){return true}return false},setBoolAttribute:function(f,e){if(e){this.setAttribute(f,f)}else{this.removeAttribute(f)}},domActivate:function(){var e=new this.ownerDocument.createEvent("UIEvent");e.initUIEvent("DOMActivate",true,true,window,null);this.dispatchEvent(e)}});var a=b.extend(null,{localName:"FormControl",getForm:function(){var e=this.htmlNode;while(e){if(e.localName=="form"||e.nodeName.toLowerCase()=="form"){return e}e=e.parentNode}}});this.UserPreferenceField=b$.Class;this.UserPreferencesForm=b$.Class});b$.module("b$.portal._private.include",function(){var p=b$.Class;var m=b$._private.ArrayMap;var b=b$._private.ArrayCollection;var f=b$.bdom.events.EventTarget;var q=b$._private.types.TypeConstraintFn;var c=b$._private.types.TypeConstraintNull;var d=b$._private.types.TypeConstraintOptional;var i=b$._private.ArrayIterator;var h=b$._private.uri.URI;var j=b$._private.template.StringTemplate;var a=b$._private.htmlAPI;var n=/^__(WIDGET|GADGET)__/;var s=new q(function(t){return/^proxy|target$/.test(t)});var e=new d(s);var r=new q(function(t){return/^GET|POST$/.test(t)});var g=p.extend(function(v,w,u,t){this.name=new j(v);this.value=new j(w);this.destination=u;this.method=t},{toQueryString:function(u){var t=encodeURIComponent(this.getName(u));return this.getValues(u).map(function(z){if(n.test(z)){var y=z.split("."),w=u;for(var x=1,v=y.length;x<v;x++){w=w[y[x]]}z=w}return t+"="+encodeURIComponent(z)}).join("&")},getName:function(t){return((this.destination=="proxy"&&this.method=="POST")?g.PROXY_PARAM_PREFIX:"")+this.name.generate(t)},getValues:function(t){return[this.value.generate(t)]}},{PROXY_PARAM_PREFIX:"internal-"});var l=g.extend(function(v,u,t){g.call(this,v,"",u,t)},{getValues:function(u){var t=u.getPreference(this.getName(u));return t instanceof Array?t:[t]}});var o=b.extend(null,{toQueryString:function(u,t,v){return this.array.filter(function(w){return w.method==t&&(!v||w.destination==v)}).map(function(w){return w.toQueryString(u)}).join("&")},toJSONObject:function(u,t,w){var v={};this.array.filter(function(x){return x.method==t&&(!w||x.destination==w)}).forEach(function(x){var y=x.getName(u);v[y]=x.getValues(u).concat(v[y]||[])});return v}});var k=f.extend(function(x,w,v,u,t){f.call(this);var y=new h(x);y.getQuery()&&y.getQuery().split("&").forEach(function(z){var A=z.split("=");u.add(new g(A[0],A[1],"target","GET"))});this.uri=new j((y.getScheme()&&(y.getScheme()+":")||"")+(y.getAuthority()&&(b$.view.url2state.separator+y.getAuthority())||"")+y.getPath());this.method=w;this.proxy=v;this.params=u;this.content=null;this.widget=t},{setContent:function(t){this.content=t;this.dispatchCustomEvent("content")},hasContent:function(){return Boolean(this.content)},getContentIterator:function(){return new i(this.content||[])},getContentURI:function(){var t=this.params.toQueryString(this.widget,"GET","target"),u=this.uri.generate(this.widget)+(t&&("?"+t));return this.proxy?gadgets.io.getProxyUrl(u,this.params.toJSONObject(this.widget,"GET","proxy")):h.resolve(u,this.widget.getOriginURI())},refresh:function(){var t=this;var v=this.getContentURI();var u=gadgets.io.makeRequest(v,function(x){var z=a.createElementFromString("<div>"+x.text+"</div>",t.widget.htmlNode.ownerDocument);var y=[];for(var w=0;w<z.childNodes.length;w++){y.push(z.childNodes[w])}t.setContent(y);t.widget.dispatchCustomEvent("includeRefreshed",true,true,{url:v,request:u,include:t})},{method:this.method,data:this.method=="POST"?this.params.toQueryString(t.widget,"POST"):""})},setUrl:function(t){if(t&&typeof t==="string"){var u=new h(t);u.getQuery()&&u.getQuery().split("&").forEach(function(v){var w=v.split("=");oParams.add(new g(w[0],w[1],"target","GET"))});this.uri=new j((u.getScheme()&&(u.getScheme()+":")||"")+(u.getAuthority()&&(b$.view.url2state.separator+u.getAuthority())||"")+u.getPath())}}});this.HttpParam=g;this.HttpPreferenceParam=l;this.HttpParams=o;this.Include=k});b$.module("b$.portal._private.definition",function(){var w=b$.Class;var k=b$._private.uri.URI;var o=b$.portal.preferences.Preference;var f=b$.portal.preferences.Preferences;var l=b$.portal.preferences.types;var q=b$.portal._private.include.HttpPreferenceParam;var b=b$._private.htmlAPI;var m=b$.Class.extend(function(){this.factories={};this.builders={}},{buildWidget:function(z,B,x,A){var z=new k(z).resolve(new k(b$.portal.config.resourceRoot)).toString();if(!this.builders[z]){this.builders[z]=new g(z)}var y=this.builders[z];if(!B){y.XListeners=y.getEventListenersByWidget(x);return A(y)}else{return y.getDefinition(A)}}});b$._private.AsyncComponentBuilder=m;var d="http://www.w3.org/1999/xhtml";var r="http://www.backbase.com/2008/gadget";var v="http://www.backbase.com/2006/tdl";var s="http://www.backbase.com/2006/client";var p=b$.portal._private.include.Include;var i=b$.portal._private.include.HttpParam;var u=b$.portal._private.include.HttpParams;var n=/(application|text)\/(x-)?backbase\+xml/;var a=/(application|text)\/(x-)?backbase\+(xml|ssr)/;var h=/(application|text)\/(x-)?backbase\+gadget\+xml/;var t=function(y,z,x){return function(A){return((!x&&A.namespaceURI==y)||x)&&((A.localName||A.baseName)==z)}};this.addCSPNonce=function(x){if(window.BB&&window.BB.config&&window.BB.config.cspNonce){x.setAttribute("nonce",window.BB.config.cspNonce)}};var g=b$.Class.extend(function(x){this.definition=null;this.loading=false;this.callbackQueue=[];this.sUrl=x;this.resources=null},{getDefinition:function(z){if(this.definition){z(this)}else{this.callbackQueue.push(z);if(!this.loading){this.loading=true;var x=new XMLHttpRequest();var y=this;x.onreadystatechange=function(){if(this.readyState==4){if(this.status==200||(this.status==0&&this.responseText!=="")){var B=this.responseText,A;var C=!!(navigator.userAgent.match(/Trident/)&&!navigator.userAgent.match(/MSIE/));if(window.ActiveXObject&&window.Performance||C){B=B.replace(/<!DOCTYPE[^>]+>/gi,"");A=new ActiveXObject("Microsoft.XMLDOM");A.async="false";A.loadXML(B)}else{A=new DOMParser().parseFromString(B,"application/xml")}y.definition=A;y.loaded=true;y.initializeDefinition();y.getResourcesFromDefinition(function(){for(var D=0;D<y.callbackQueue.length;D++){y.callbackQueue[D](y)}})}else{}}};x.open("GET",encodeURI(this.sUrl));x.send()}else{}}},initializeDefinition:function(){this.XTitle=this.getTitleFromDefinition();this.XIcon=this.getIconFromDefinition();this.XListeners=this.getEventListenersFromDefinition();this.XClasses=this.getClassesFromDefinition()},getTitleFromDefinition:function(){var y=b.getChildren(this.definition.documentElement);var A=y.filter(t(d,"head"));var z=b.getDescendants(A);var B=z.filter(t(d,"title"));var x=b.getContents(B);return x.map(function(C){return C.xml||new XMLSerializer().serializeToString(C)}).join("")},getIconFromDefinition:function(){var x=b.getChildren(this.definition.documentElement);var z=x.filter(t(d,"head"));var y=b.getDescendants(z);var A=y.filter(function(B){return B.namespaceURI==d&&(B.localName||B.baseName)=="link"&&B.getAttribute("rel")=="icon"});return A.length?k.resolve(A[0].getAttribute("href")||"",this.src):null},createEventHandlerFromString:function(y){var z=document.createElement("script");z.setAttribute("type","text/javascript");var x=y.replace(/(__GADGET__|__WIDGET__)/gm,"this");z.text="b$._private.currentHandlerFunction = function(event){"+x+"}";b$.portal._private.definition.addCSPNonce(z);document.head.appendChild(z);return b$._private.currentHandlerFunction},getEventListenersFromDefinition:function(){var z=b.getChildren(this.definition.documentElement);var y=z.filter(t(d,"body"));var B=y[0];var A={};if(B){for(var C=0,D,x;D=B.attributes[C];C++){x=D.localName||D.baseName;if(D.namespaceURI=="http://www.backbase.com/2008/gadget"&&x.substr(0,2)=="on"){try{A[x.substr(2)]=this.createEventHandlerFromString(D.nodeValue)}catch(E){console.log(E)}}}}else{}return A},getEventListenersByWidget:function(F){var z=F.body.firstChild;var E={};var x="g:";var y="on";if(!z){return E}for(var C=0,D,A;D=z.attributes[C];C++){A=D.localName||D.baseName;if(A.indexOf(y)===x.length){try{E[A.substr(y.length+x.length)]=this.createEventHandlerFromString(D.nodeValue)}catch(B){console.log(B)}}}return E},getClassesFromDefinition:function(){var z=b.getChildren(this.definition.documentElement);var y=z.filter(t(d,"body"));var A=y[0];var D=[];if(A){for(var B=0,C,x;C=A.attributes[B];B++){x=C.localName||C.baseName;if(x==="class"){D=C.nodeValue.split(/\s+/)}}}else{}return D},getPreferencesFromDefinition:function(z){if(!z.model){return}var A=b.getChildren(this.definition.documentElement);var C=A.filter(t(d,"head"));var D=b.getDescendants(C);var y=D.filter(t(r,"preferences"))[0];var F=b.getChildren(y);var x=this;var B=t(r,"preference");var E=0;var G=z.model.preferences;F.map(function(K){if(!B.apply(K,arguments)){}var H=K.getAttribute("type"),Q=K.getAttribute("default"),M=K.getAttribute("name"),O=K.getAttribute("viewHint"),J=K.getAttribute("manageable"),R=K.getAttribute("label")||M,I=K.getAttribute("onchange")||"";var L;if(H=="range"){L=new b$.portal.preferences.inputType.range();L.min=Number(K.getAttribute("min"));L.max=Number(K.getAttribute("max"));L.step=Number(K.getAttribute("step"))}else{if(H=="select-one"||H=="select-multiple"||H=="checkbox"||H=="checkbox-multiple"||H=="radio"){L=new b$.portal.preferences.inputType[H]();var P=b.getChildren(K).filter(t(r,"enumeration")).map(function(T){var U=T.getAttribute("value")||T.textContent||T.text;if(U.replace){U=U.replace("%5BBBHOST%5D","[BBHOST]")}var S=T.getAttribute("label")||U;L.options.push({value:U,label:S})})}else{if(b$.portal.preferences.inputType[H]){L=new b$.portal.preferences.inputType[H]()}else{L=new b$.portal.preferences.inputType.text()}}}var N=G.getByName(M);if(N){N.inputType=L;G.remove(N);G.insert(N,E++)}else{N=z.model.ownerDocument.createPreference(M,"string");N.value=N.dataType.parseFromString(Q);N.label=R;N.viewHint=O;N.manageable=J&&J==="true";N.inputType=L;G.insert(N,E++)}if(I){N.addEventListener("change",x.createEventHandlerFromString(I),false,z)}})},getResourcesFromDefinition:function(y,x){b$.portal._private.definition.getResourcesFromDefinition(this.definition,this.sUrl,y,x)},getIncludesFromDefinition:function(y){var x=b.getChildren(this.definition.documentElement).filter(t(d,"body"));var A=b.getDescendants(x).filter(t(r,"include"));var z=this;function B(F){var D=y.model.preferences;var E=F.match(/\$\{(.*?)\}/g)||[];E.forEach(function(G){var J=G.replace("${","").replace("}","");var H=D.getByName(J);var I="";if(H){I=H.getValue()}F=F.replace(G,I)});F=F.replace("$(contextRoot)",b$.portal.portalModel.serverURL);return F}function C(E){var G=y.model.preferences.array;var D=[];for(var F=0;F<G.length;F++){if(G[F].dataType.name==E){D.push(G[F])}}return D}return A.map(function(D){return new p(D.getAttribute("src")?B(D.getAttribute("src")):"",(D.getAttribute("method")||"GET").toUpperCase(),(D.getAttribute("proxy")||"").toLowerCase()=="true",(function(){var E=[];var J=b.getChildren(D).filter(function(K){return K.namespaceURI==r&&/^(http-(proxy-|preference-)?)param(-map)?$/.test(K.localName||K.baseName)});for(var G=0;G<J.length;G++){var I=J[G].localName||J[G].baseName;if(I=="http-preference-param"){E.push(new q(J[G].getAttribute("name"),"target",(J[G].getAttribute("method")||"GET").toUpperCase()))}else{if(I=="http-preference-param-map"){var F=C(J[G].getAttribute("dataType"));for(var H=0;H<F.length;H++){E.push(new i((F[H].dataType.name+"."+F[H].name),F[H].value,"target",(J[G].getAttribute("method")||"GET").toUpperCase()))}}else{E.push(new i(J[G].getAttribute("name"),J[G].getAttribute("value"),I=="http-proxy-param"?"proxy":"target",(J[G].getAttribute("method")||"GET").toUpperCase()))}}}return new u(E)}()),y)})},getHTMLBodyFromDefinition:function(){var A=this.definition.documentElement.cloneNode(true),z=b.getChildren(A).filter(t(d,"body"))[0],C=new XMLSerializer(),E=this.src;b.getDescendants(z).forEach(function(I){var K=I.localName||I.baseName,J=I.namespaceURI,L="",H="";if(J==d&&/^(a|area|img|input|iframe|form)$/.test(K)){L=/^(a|area)$/.test(K)?"href":(/^(img|input|iframe)$/.test(K)?"src":"action");H=I.getAttribute(L);if(H){I.setAttribute(L,k.resolve(H,E))}}else{if(J==d&&K=="script"){var M=I.getAttribute("type");if(a.test(M)){console.log("BB4 Island disbled... "+M)}else{}}else{if(J==r&&K=="include"){var G=I.ownerDocument.createElement("div");G.setAttribute("class","bp-g-include");I.parentNode.replaceChild(G,I)}}}});var x=document.createElement("div"),D=A.getAttribute("style")||"",F=z.getAttribute("style")||"",B=A.getAttribute("class")||"",y=z.getAttribute("class")||"";x.innerHTML=("x<div"+((D||F)?' style="'+(D&&D+"; ")+F+'"':"")+((B||y)?' class="'+(B&&B+" ")+y+'"':"")+">"+b.getContents(z).map(function(G){return(G.xml||C.serializeToString(G)).replace(/<([\w:]+)([^>]*)\/>/gi,"<$1$2></$1>")}).join("")+"</div>");return x.lastChild}},{CSS_IMPORT_REGEXP:/@import\s+(?:'((?:[^\\']|\\.)*)'|"((?:[^\\"]|\\.)*)")/gm,CSS_URL_REGEXP:/url\(\s*(?:'((?:[^\\']|\\.)*)'|"((?:[^\\"]|\\.)*)"|((?:[^\\\)]|\\.)*))\s*\)/gm,CSS_ESCAPE_REGEXP:/\\([^\n\r\f0-9a-fA-F])|\\([0-9a-fA-F]{1,6})(?:\r\n|[ \n\r\t\f])?/g,unescapeCSSLiteral:function(x){return x.replace(g.CSS_ESCAPE_REGEXP,function(z,y,A){return y||String.fromCharCode(parseInt(A,16))})},resolveUrlsInCSS:function(y,x){return y.replace(g.CSS_URL_REGEXP,function(B,z,C,A){return"url('"+k.resolve(g.unescapeCSSLiteral(z||C||A),x).replace(/'/g,"\\'")+"')"}).replace(g.CSS_IMPORT_REGEXP,function(A,z,B){return"@import '"+k.resolve(g.unescapeCSSLiteral(z||B),x).replace(/'/g,"\\'")+"'"})}});function j(B){var x=[];var z=B.attributes;if(window.ActiveXObject&&!window.Performance){for(var A=0,y=z.length;A<y;A++){x.push({name:z[A].name,value:z[A].value})}}else{for(var A in z){if(z.hasOwnProperty(A)){x.push({name:z[A].name,value:z[A].value})}}}return x}var e=b$._private.ResourceSequence;this.getResourcesFromDefinition=function(I,x,H,y,G){var C=new e();var F=b.getChildren(I.documentElement);var D=F.filter(t(d,"head",G))[0];var A=F.filter(t(d,"body",G))[0];var B=b.getDescendants(D),E=b.getDescendants(A),z=encodeURI(x);B.filter(t(d,"link",G)).forEach(function(N){var M=N.getAttribute("href"),K=N.getAttribute("rel"),L=N.getAttribute("type")||"text/css";var J=j(N);M=M.replace("$(contextRoot)",b$.portal.portalModel.serverURL);if(K=="stylesheet"&&L=="text/css"&&!/standalone\.css$/.test(M)){C.addURI(L,k.resolve(M,z),null,J)}});B.filter(t(d,"script",G)).forEach(function(N){var K=N.getAttribute("src"),M=N.textContent||N.text,L=N.getAttribute("type")||"text/javascript";var J=j(N);if(K&&!/standalone\.js$/.test(K)){K=K.replace("$(contextRoot)",b$.portal.portalModel.serverURL);C.addURI(L,k.resolve(K,z),null,J)}else{if(!K&&M){C.addInline(L,M,null,J)}}});B.filter(t(d,"style",G)).forEach(function(M){var L=M.textContent||M.text,K=M.getAttribute("type")||"text/css";var J=j(M);if(L){C.addInline(K,L,null,J)}});E.filter(t(v,"tdl",G)).forEach(function(M){var J=b.getParents(M).filter(t(d,"script",G))[0],K=J.getAttribute("type")||"text/javascript",L=new XMLSerializer();if(n.test(K)){}});C.startLoading(H,y);return};function c(y,A,x){var z=new XMLHttpRequest();z.onreadystatechange=function(){if(this.readyState==4){var C=(this.status+"").charAt(0);if(C=="0"||C=="2"||C=="3"){A(this)}else{var D=this;var B={readyState:D.readyState,responseText:D.responseText,status:D.status,statusText:D.statusText};x(B)}}};z.open("GET",y,false);z.send()}this.getResourcesFromDefinitionSynchronous=function(A,y,D){var z=b.getChildren(A.documentElement);var C=z.filter(t("http://www.backbase.com/ns/widgets","resources"))[0];var x=b.getDescendants(C);var B=encodeURI(y);x.filter(t(d,"link")).forEach(function(H){var I=H.getAttribute("href"),M=H.getAttribute("rel"),E=H.getAttribute("type")||"text/css";I=I.replace("$(contextRoot)",b$.portal.portalModel.serverURL);var K=j(H);if(M=="stylesheet"&&E=="text/css"&&!/standalone\.css$/.test(I)){var L=document.createElement("link");for(var J=K.length-1;J>=0;J--){L.setAttribute(K[J].name,K[J].value)}L.type=E;L.href=k.resolve(I,B);var F=document.createAttribute("rel");F.nodeValue="stylesheet";L.setAttributeNode(F);var G=document.getElementsByTagName("head")[0];b$.portal._private.definition.addCSPNonce(L);G.appendChild(L)}});x.filter(t(d,"script")).forEach(function(I){var E=I.getAttribute("src"),K=I.textContent||I.text,F=I.getAttribute("type")||"text/javascript";var L=j(I);if(E&&!/standalone\.js$/.test(E)){E=E.replace("$(contextRoot)",b$.portal.portalModel.serverURL);var M=document.createElement("script");M.type=F;for(var J=b$._private.resourceManager.resources.length-1;J>=0;J--){if(b$._private.resourceManager.resources[J].uri==k.resolve(E,B)){return}else{var G=new e();G.addURI(F,k.resolve(E,B),null,L)}}c(k.resolve(E,B),function(P){M.text=P.responseText;var O=document.getElementsByTagName("head")[0];b$.portal._private.definition.addCSPNonce(M);O.appendChild(M)})}else{if(!E&&K){var N=document.createElement("script");N.type=F;N.text=K;var H=document.getElementsByTagName("head")[0];b$.portal._private.definition.addCSPNonce(N);H.appendChild(N)}}});x.filter(t(d,"style")).forEach(function(J){var G=J.textContent||J.text,F=J.getAttribute("type")||"text/css";var E=j(J);if(G){var I=document.createElement("style");I.type=F;if(I.styleSheet){I.styleSheet.cssText=G}else{I.appendChild(document.createTextNode(G))}var H=document.getElementsByTagName("head")[0];H.appendChild(I)}});if(D){D()}};this.getResourcesFromConfig=function(x,A){var z=x.replace("$(contextRoot)",b$.portal.portalModel.serverURL);var y=new XMLHttpRequest();y.onreadystatechange=function(){if(this.readyState==4){var E=(this.status+"").charAt(0);if(E=="0"||E=="2"||E=="3"){var D=this.responseText,B;if(window.ActiveXObject&&window.Performance){B=new ActiveXObject("Microsoft.XMLDOM");B.async="false";B.loadXML(D)}else{B=new DOMParser().parseFromString(D,"application/xml")}b$.portal._private.definition.getResourcesFromDefinitionSynchronous(B,z,A)}else{var C={readyState:this.readyState,responseText:this.responseText,status:this.status,statusText:this.statusText};console.log(C)}}};y.open("GET",encodeURI(z),false);y.setRequestHeader("Content-Type","application/xml");y.send(null)}});b$.module("b$.portal.view.bdom.default",function(){var e=function(){return this}();var f=b$.bdom.Namespace;var o=b$.view.bdom.Component;var s=b$.view.perspective.Perspective;var p=b$.view.perspective.PerspectiveType;var j=b$.view.perspective.PerspectiveParameters;var m=b$._private.template.SimpleURITemplate;var c=b$._private.htmlAPI;var u=b$._private.xml;var i=f.extend(function(w){f.call(this,w)},{});var r=new i("http://backbase.com/2012/portalView");this.NS=r;var q=function(x,A,z,w){var y=this;b$.portal.portalServer.loadItemHTML(x.originalItem,function(F,E){var D=F.substring(0,F.indexOf("<body>"))+"</html>";var B=F.substring(F.indexOf("<body>")+6,F.indexOf('<script type="text/backbase-xml'));var G="";if(F.indexOf('<script type="text/backbase-xml">')!==-1){G=F.substring(F.indexOf('<script type="text/backbase-xml">')+33,F.indexOf("<\/script>",F.indexOf('<script type="text/backbase-xml">')+33))}var C=u.parse(D);b$.portal._private.definition.getResourcesFromDefinition(C,"",function(){var L=c.createElementFromString(B);var J=x.ownerDocument;x.destroy();var I=u.parse(G);var K=b$.portal.importPortalModel(I,J,null,L);if(z){z(K,E)}var H=L.viewController;if(H.ownerDocument.documentElement.designMode){H.enableDesignMode()}},function(){var J=c.createElementFromString("<span>This part of the page can't be rendered </span>");J.viewController=A.viewController;A.appendChild(J);var H=u.parse(G);var I=b$.portal.portalServer.itemXMLDOC2JSON(H);x.setItem(I);if(z){z()}})},w,true)};b$.portal.refreshHTML=q;var h={ADMIN:0,CREATOR:-1,COLLABORATOR:-2,CONTRIBUTOR:-3,CONSUMER:-4};var b=r.registerElement("deprecatedElement",o.extend(function(y,x,w,z){o.apply(this,arguments)},{namespaceURI:"http://backbase.com/2012/portalView",buildHTML:function(w){if(!w){w=c.createElementFromString(this.doTemplate(this.buildJSON()))}return w},buildDisplay:function(){this.htmlNode=this.buildHTML(this.htmlNode);if(!this.htmlAreas){var w=this.getDisplay("area",true);if(!w.length){w=c.findCaptureClass("bp-area",this.htmlNode)}this.htmlAreas=w}if(this.htmlNode){this.htmlNode.viewController=this}return this.htmlNode},attachHTMLChildren:function(){var y=this.getAreaOrderedChildren();var x=false;for(var A=0;A<y.length;A++){if(y[A]){var z=0;var C=y[A][z].getHTMLNode();var B=this.htmlAreas[A];if(!B){B=this.htmlAreas[this.htmlAreas.length-1]}var w=B.firstChild;if(!w){B.appendChild(C);x=true}else{while(w){if(w.nodeType==1&&w.viewController){var C=y[A][z].getHTMLNode();if(w.viewController==y[A][z]){}else{w.parentNode.insertBefore(C,w)}z++;if(z==y[A].length){break}}w=w.nextSibling}}while(z<y[A].length){var C=y[A][z].getHTMLNode();z++;B.appendChild(C)}}}}}));b$.mixin(b.prototype,b$.bdom.BOldNode);var d=r.registerElement("portalViewElement",b.extend(function(y,x,w,z){b.apply(this,arguments);if(this.ownerDocument.defaultDragHandlers){this.addHandlers(this.ownerDocument.defaultDragHandlers)}},{namespaceURI:"http://backbase.com/2012/portalView",dragIsTarget:function(){return this.isPossibleDragTarget},refreshHTML:function(A,w){var z=this.model.parentNode;var x=this.ownerDocument;q(this.model,null,function(E,B){var D,C;z.appendChild(E);D=x.all[b$.portal.portalReflector.getID(z)];C=x.all[b$.portal.portalReflector.getID(E)];D.insertDisplayChild(C);if(A){A(C,B)}});return;var y=this;b$.portal.portalServer.loadItemHTML(this.model.getJSON(),function(E){var D=E.substring(0,E.indexOf("<body>"))+"</html>";var B=E.substring(E.indexOf("<body>")+6,E.indexOf('<script type="text/backbase-xml"'));var F="";if(E.indexOf('<script type="text/backbase-xml">')!==-1){F=E.substring(E.indexOf('<script type="text/backbase-xml">')+33,E.indexOf("<\/script>",E.indexOf('<script type="text/backbase-xml">')+33))}var C=u.parse(D);b$.portal._private.definition.getResourcesFromDefinition(C,"",function(){if(y.htmlNode!=null){y.htmlNode.innerHTML=""}var J=c.createElementFromString(B);if(!J){J=c.createElementFromString("<span>"+B+"</span>")}J.viewController=y.htmlNode.parentNode.viewController;y.htmlNode.parentNode.insertBefore(J,y.htmlNode);var H=y.model.parentNode;y.model.destroy();var G=u.parse(F);var I=b$.portal.portalServer.itemXMLDOC2JSON(G);b$.portal._buildModelFromJSON(H.ownerDocument,I,H);if(A){A()}})},w,true)},loadChildren:function(B,A){var y=[];if(!this.model._children){return}if(B){y.push(B)}else{y=this.model._children}var x=this;for(var w=y.length-1;w>=0;w--){if(b$.portal.portalModel.getElementById(y[w].name)){break}var z=function(E,H){var G=E.substring(0,E.indexOf("<body>"))+"</html>";var C=E.substring(E.indexOf("<body>")+6,E.indexOf('<script type="text/backbase-xml'));var I="";if(E.indexOf('<script type="text/backbase-xml">')!==-1){I=E.substring(E.indexOf('<script type="text/backbase-xml">')+33,E.indexOf("<\/script>",E.indexOf('<script type="text/backbase-xml">')+33))}var D=function(){var R=b$._private.htmlAPI.createElementFromString(C);var S=b$._private.xml.parse(I);var P=0;var L=0;var K=navigator.userAgent.toLowerCase();if(!(K.indexOf("msie")!=-1)&&parseInt(K.split("msie")[1])>9){P=b$._private.xml.textContent(b$.ua.querySelector(S,"property[name=area] value"))||0;L=b$._private.xml.textContent(b$.ua.querySelector(S,"property[name=order] value"))||0}var N=x.htmlAreas[P];var O=true;var Q=null;for(var M=0;M<N.childNodes.length;M++){if(N.childNodes[M].getAttribute("data-pid")==R.getAttribute("data-pid")){O=false;break}else{if(L<N.childNodes[M].viewController.getPreference("order")){Q=N.childNodes[M]}}}if(O){if(Q){N.insertBefore(R,Q)}else{N.appendChild(R)}}var J=b$.portal.importPortalModel(S,b$.portal.portalModel,x.model,R);if(A){A(R.viewController)}};var F=b$._private.xml.parse(G);b$.portal._private.definition.getResourcesFromDefinition(F,"",D)};b$.portal.portalServer.loadItemHTML(y[w],z,null,true,-1,null)}},getPreference:function(w,y){var x=this.model?this.model.getPreference(w):this.getAttribute(w);return y?decodeURIComponent(x):x},setPreference:function(w,x){return this.model.setPreference(w,x)},isPreference:function(w){var x=this.getPreference(w);return x!=null&&x!=""},getAreaPreference:function(){if(this.area===undefined){if(this.model){var w=parseInt(this.model.getPreference("area"),10);if(isNaN(w)){w=0}}else{var w=parseInt(this.getAttribute("area"),10);if(isNaN(w)){w=0}}return w}else{return this.area}},getOrderPreference:function(){if(this.order===undefined){if(this.model){var w=parseInt(this.model.getPreference("order"),10);if(isNaN(w)){w=0}}else{var w=parseInt(this.getAttribute("order"),10);if(isNaN(w)){w=0}}return w}else{return this.order}},m_dragEnter:function(B,A){var z=h[this.model.securityProfile];if(z<h.CONTRIBUTOR){return false}var w=B.clientX;var C=B.clientY;this.appendChild(this.ownerDocument.dragIndicator)},m_dragOut:function(E,A){var z=h[this.model.securityProfile];if(z<h.CONTRIBUTOR){return false}var w=E.clientX;var F=E.clientY;var C=this.ownerDocument.dragIndicator.getDisplay();if(C){C.parentNode.removeChild(C);this.removeChild(this.ownerDocument.dragIndicator)}delete this.tmp_lastTargetAreaId;var D=this.childNodes;for(var B=0;B<D.length;B++){D[B].tmp_order=D[B].order;delete D[B].area;delete D[B].order}this.reflow()},m_dragMove:function(N,L){var C=h[this.model.securityProfile];if(C<h.CONTRIBUTOR){return false}var w=document.body.scrollTop?document.body.scrollTop:document.body.parentNode.scrollTop?document.body.parentNode.scrollTop:0;var M=document.body.scrollLeft?document.body.scrollLeft:document.body.parentNode.scrollLeft?document.body.parentNode.scrollLeft:0;var E=N.clientX+M;var D=N.clientY+w;var J=this.getDisplay("area",true);if(!J.length){J=c.findCaptureClass("bp-area",this.htmlNode)}var B=null;var W=null;var I=Infinity;var G="";for(var P=0;P<J.length;P++){var H=c.getBoxObject(J[P],"border");if(l(E,D,H.x,H.y,H.w,H.h)){B=P;break}var T=Math.abs((H.x+H.w/2)-E)+Math.abs((H.y+H.h/2)-D);if(T<I){I=T;W=P}}if(B==null){if(this.tmp_lastTargetAreaId){B=this.tmp_lastTargetAreaId}else{if(W==null){B=0}else{B=W}}}this.tmp_lastTargetAreaId=B;var O=null;var R=L.dataTransfer.getData("x-bb-nodelist");if(R&&R[0]){O=R[0]}var V=J[B];L.__tmpArea=B;L.__tmpOrder=0;this.ownerDocument.dragIndicator.area=B;var A=this.getAreaOrderedChildren();var S=A[B];var K=false;if(S){for(var P=0;P<S.length;P++){if(S[P]!=this.ownerDocument.dragIndicator){if(!K){var H=c.getBoxObject(S[P].htmlNode,"border");if((this.layout.dir.direction=="horizontal"&&E<H.x+(H.w/2))||(this.layout.dir.direction=="vertical"&&D<H.y+(H.h/2))){K=true;this.ownerDocument.dragIndicator.order=L.__tmpOrder;var F=this.ownerDocument.dragIndicator.getDisplay();var Q=S[P].getDisplay();Q.parentNode.insertBefore(F,Q);L.__tmpOrder++;if(O==S[P].model){F.display="none"}else{F.display="block"}}}S[P].order=L.__tmpOrder;L.__tmpOrder++}}}if(!K){this.ownerDocument.dragIndicator.order=L.__tmpOrder;if(!J[B]){console.log("____________________________________________",this)}J[B].appendChild(this.ownerDocument.dragIndicator.getDisplay())}var z=this.ownerDocument.dragIndicator;var O;var U=L.dataTransfer.getData("x-bb-nodelist");if(U){O=U[0]}z.getDisplay().style.display="block";if(!L.dragOptions.htmlNode.catalogItemJson){if(O.parentNode==z.parentNode){if(O.getAreaPreference()==z.area){if(O.order+1==z.order||O.order-1==z.order){z.getDisplay().style.display="none"}}}}this.reflow();return},m_dragDrop:function(x,H,F){var B=h[this.model.securityProfile];if(B<h.CONTRIBUTOR){return false}var A=F;if(A.isCatalog){}else{var E=A.parentNode;var w=E.childNodes;if(this!=E){for(var G=0;G<w.length;G++){if(A!=w[G]){w[G].model.setPreference("order",w[G].tmp_order);w[G].model.save()}}}}var w=this.childNodes;for(var G=0;G<w.length;G++){if(A!=w[G]&&w[G].tmp_order){w[G].model.setPreference("order",w[G].tmp_order);w[G].model.save()}}if(A.isCatalog&&H.dragOptions.htmlNode&&H.dragOptions.htmlNode.catalogItemJson){var J=this.model.createExtendedElementFromJSON(H.dragOptions.htmlNode.catalogItemJson);if(H.dragOptions.htmlNode.catalogItemJson.children){for(var G=0,D=H.dragOptions.htmlNode.catalogItemJson.children.length;G<D;G++){var C=this.model.createExtendedElementFromJSON(H.dragOptions.htmlNode.catalogItemJson.children[G]);J.appendChild(C,true)}}var I=this.model;J.parentItemName=I.name;var y=J.getPreferenceNode("area");if(y){J.setPreference("area",this.ownerDocument.dragIndicator.area+"")}else{y=this.model.ownerDocument.createPreference("area","string");y.value=this.ownerDocument.dragIndicator.area+"";J.setPreferenceNode(y)}var y=J.getPreferenceNode("order");if(y){J.setPreference("order",this.ownerDocument.dragIndicator.order+"")}else{y=this.model.ownerDocument.createPreference("order","double");y.value=this.ownerDocument.dragIndicator.order+"";J.setPreferenceNode(y)}var z=this;J.save(function(){if(!J.contextItemName){J.isWidgetRenderingTriggeredByDragAndDropFromTargeting=true;I.appendChild(J)}else{q(J,z.htmlNode,function(M){var L,K;M.isWidgetRenderingTriggeredByDragAndDropFromTargeting=true;I.appendChild(M);L=z.ownerDocument.all[b$.portal.portalReflector.getID(I)];K=z.ownerDocument.all[b$.portal.portalReflector.getID(M)];L.insertDisplayChild(K)})}})}else{A.model.setPreference("area",this.ownerDocument.dragIndicator.area.toString());var y=A.model.getPreferenceNode("order");if(y){A.model.setPreference("order",this.ownerDocument.dragIndicator.order+"")}else{y=this.model.ownerDocument.createPreference("order","double");y.value=this.ownerDocument.dragIndicator.order+"";A.model.setPreferenceNode(y)}A.model.parentItemName=this.model.name;this.model.appendChild(A.model);A.model.save()}if(E){E.reflow()}this.reflow()},createPerspective:function(w,x){return new s(new m("/","page"),w,x)},getCurrentPerspective:function(){return this.perspective},setCurrentPerspective:function(w){this.perspective=w},addHandlers:function(w){for(var x in w){if(w.hasOwnProperty(x)){this.addEventListener(x,w[x])}}},removeHandlers:function(w){for(var x in w){if(w.hasOwnProperty(x)){this.removeEventListener(x,w[x])}}},processConfig:function(){try{var x=this.getPreference("config");if(x){var w=JSON.parse(x);b$.mixin(this,w)}}catch(y){console.log("Error parsing config: "+y)}},persistConfig:function(){try{var y=this.getPreference("config");var w=JSON.parse(y);for(var x in w){if(w[x]!==this[x]){w[x]=this[x]}}y=JSON.stringify(w);this.setPreference("config",y);this.model.save()}catch(z){console.log("Error persisting config: "+z)}},addToConfig:function(w,A){try{var y=this.getPreference("config");var x=JSON.parse(y);x[w]=A;y=JSON.stringify(x);this.setPreference("config",y);this.model.save()}catch(z){console.log("Error adding preference to config: "+z)}},removeFromConfig:function(w){try{var y=this.getPreference("config");var x=JSON.parse(y);delete x[w];y=JSON.stringify(x);this.setPreference("config",y);this.model.save()}catch(z){console.log("Error removing preference from config: "+z)}}}));this.portalViewElement=d;function k(x,w){x=parseInt(x.getOrderPreference())||0;w=parseInt(w.getOrderPreference())||0;return x-w}function l(C,A,z,E,B,D){if(C>=z&&C<=z+B&&A>=E&&A<=E+D){return true}return false}var t=b$.view.bdom.layout;var v=r.registerElement("application",d.extend(function(y,x,w,z){d.apply(this,arguments);this.layout=new t.NoLayout(this)},{doTemplate:function(w){},buildHTML:function(w){return w},readyHTML:function(){},insertDisplayChild:function(w){},showDesignTools:function(){},hideDesignTools:function(w){}}));var a=r.registerElement("portal",d.extend(function(y,x,w,z){d.apply(this,arguments);this.perspective=this.createPerspective(new p("Dashboard"),new j());this.addEventListener("PerspectiveModified",function(A){this.setCurrentPerspective(this.createPerspective(new p(A.newValue),new j()))},false,this)},{doTemplate:function(w){return'<div class="'+this.cls+" "+this.cls+'--area"></div>';return'<div class="'+this.cls+'"><div class="'+this.cls+'--area"></div></div>'},injectDisplaySelf:function(){},insertDisplayChild:function(w){if(!(w.model&&w.model._ssr)){b$._private.ssrRootElement.appendChild(w.htmlNode)}},attachHTMLChildren:function(){var w=this.childNodes;for(var x=0;x<w.length;x++){var y=w[x].getHTMLNode();if(!y.parentNode||y.parentNode.nodeType!=1){document.body.appendChild(y)}}},showDesignTools:function(){},hideDesignTools:function(){}}));var n=r.registerElement("page",d.extend(function(y,x,w,z){d.apply(this,arguments);this.layout=new t.NoLayout(this);this.isPossibleDragTarget=true},{pageType:undefined,doTemplate:function(w){return'<div class="'+this.cls+'"><div class="'+this.cls+'--area"></div></div>'},buildDisplay:function(y){if(!this.htmlNode){this.htmlNode=this.buildHTML(y);var x=this.getDisplay("area",true);if(!x.length){x=c.findCaptureClass("bp-area",this.htmlNode)}this.htmlAreas=x;return}if(!this.htmlAreas){this.htmlAreas=[];var w=c.findCaptureClass("bp-area",this.htmlNode);if(w[0]){c.addClass(w[0],"--area");this.htmlAreas.push(w[0])}}if(this.model.manageable){this.pageType="master"}else{if(this.model.extendedItemName==""){this.pageType="normal"}else{this.pageType="inherited"}}},readyHTML:function(){d.prototype.readyHTML.call(this)},showDesignTools:function(){},hideDesignTools:function(){}}));var g=r.registerElement("dragIndicator",d.extend(function(y,x,w,z){d.apply(this,arguments);this.layout=new t.AutoLayout(this);this.isPossibleDragTarget=false;this.flex=1;this.area=0;this.order=0},{setHTMLWidthHeight:function(x,w){var y=this.htmlNode;c.setWidthHeightPB(y,x,w);c.setWidthHeightPB(y.firstChild,x-c.getPadding(y)-c.getBorder(y),w-c.getPadding(y,"tb")-c.getBorder(y,"tb"))},buildHTML:function(w){if(!w){w=document.createElement("div");w.className="bp-drag-indicator";w.innerHTML='<div class="bp-drag-indicator-in"><span class="bp-drag-text"></span></div>'}return w},getAreaPreference:function(){return this.area},getOrderPreference:function(){return this.order},setAreaPreference:function(w){this.area=w},setOrderPreference:function(w){this.order=w}}))});b$.module("b$.portal.view.bdom.container",function(){var b=b$.Class;var e=b$._private.htmlAPI;var d=b$.bdom.getNamespace("http://backbase.com/2012/portalView");var c=d.getClass("portalViewElement");var g=b$.view.preferences;var f=b$.view.bdom.layout;var a=d.registerElement("container",c.extend(function(j,i,h,k){c.apply(this,arguments);this.layout=new f.NoLayout(this)},{buildHTML:function(j){var h=document;if(!j){var i=this.getContainerTemplate();if(!j){j=e.createElementFromString(i,h)}}return j},getContainerTemplate:function(){var h='<div class="bp-container"><div class="bp-container-pref"></div><div class="bp-area"></div></div>';return h},appendPreferencesForm:function(i,l,h){return;var j=g.showPreferencesPane(document,l);var k=e.cssSelector(".bp-container-pref",i);k.appendChild(j.getDisplay())},constrainProportions:function(l,h){var n=0,k,j,m;m=l.concat(new Array(h)).splice(0,h);for(j=0;j<h;j++){m[j]=Math.round((m[j]||0)*100)/100;n+=m[j]}if(n===0){for(j=0;j<h;j++){m[j]=Math.round(100/h*100)/100}}else{if(n!==100){k=n/100;for(j=0;j<h;j++){m[j]=m[j]/k}}}return m}}))});b$.module("b$.portal.view.bdom.widget",function(){var j=function(){return this}();var e=b$.view.perspective.PerspectiveType;var a=b$.view.perspective.PerspectiveParameters;var f=b$.view.perspective.Perspective;var i=b$._private.template.SimpleURITemplate;var g=b$._private.htmlAPI;var c=b$._private.simpleResponseCache_getData;var d=b$.bdom.getNamespace("http://backbase.com/2012/portalView");var b=d.getClass("portalViewElement");var h=d.registerElement("widget",b.extend(function(m,l,k,n){b.apply(this,arguments);this.id="none";this.flex=1},{buildHTML:function(l){var k=document;if(!l){l=b$.portal.view.loadChrome(this,k)}this.bindChromeHandlers();this.htmlAreas=[];this.htmlAreas[0]=g.cssSelector(".bp-widget-body",l)[0];return l},setHTMLWidthHeight:function(l,k){var m=this.htmlNode;if(l!==undefined){g.setWidth(m,l)}if(k!==undefined){g.setHeight(m,k);g.setHeightPB(this.htmlAreas[0],k-this.htmlHead.offsetHeight-this.htmlFoot.offsetHeight)}},readyHTML:function(){var k=this;if(this.ownerDocument.defaultDragHandlers){this.addHandlers(this.ownerDocument.defaultDragHandlers)}this.id=this.model.name;if(k.model){k.model.addEventListener("PrefModified",function(n){if(n.target===k.model){var l=n.relatedNode;if(l){var m=this.ownerDocument.createEvent("UIEvent");m.initUIEvent("change",true,false,window,null);l.dispatchEvent(m,false)}}},false,k);k.model.addEventListener("PrefFallback",function(l){if(l.target===k.model){k.refreshHTML()}},false,k);this.addEventListener("PerspectiveModified",function(m){if(m.target.model===this.model&&(m.newValue==="Maximized"||m.newValue==="Widget")){var l=this.ownerDocument.createEvent("MutationEvent");l.initMutationEvent(m.newValue==="Maximized"?"maximize":"restore",true,false,this,null,null,null,null);this.model.dispatchEvent(l,true)}},false,this)}},bindChromeHandlers:function(){var k=this;g.bindEvent(this.htmlNode,"click",function(o){var q=o.target;var p;var m=g.cssSelector(".bp-widget-pref",this)[0];while(true){p=q.getAttribute("data-action");if(p){switch(p){case"widget-preferences":k.dispatchCustomEvent("preferences-form",true,true,{context:k});break;case"widget-maximize":k.setPerspective("Maximized");break;break;case"widget-restore":k.setPerspective("Widget");q.setAttribute("data-action","widget-minimize");break;case"widget-minimize":k.setPerspective("Minimized");q.setAttribute("data-action","widget-restore");break;case"widget-refresh":k.refreshHTML();break;case"widget-close":k.model.destroyAndSave();break;case"pref-ok":var n=g.cssSelector("form",m)[0];for(var l=0;l<n.elements.length;l++){var r=n.elements[l];if(r.type==="text"){if(r.value!==k.model.getPreference(r.name)){console.log(r.name,r.value);k.model.setPreference(r.name,r.value)}}else{if(r.type==="checkbox"){if(r.checked!==k.model.getPreference(r.name)){console.log(r.name,r.checked);k.model.setPreference(r.name,r.checked)}}}}k.model.save();m.style.display="none";break;case"pref-cancel":m.style.display="none";break}}if(q==o.currentTarget){break}q=q.parentNode;if(!q){break}}})},setTitle:function(k){this.model.setPreference("title",k);this.model.save()},getDefinition:function(){return{}},setPerspective:function(l){if(l!==this.perspective.getType().getName()){this.perspective=new f(new i(this.getDefinition().sUrl||this.sSrc,"page"),new e(l),new a());var k=this.ownerDocument.createEvent("MutationEvent");k.initMutationEvent("PerspectiveModified",true,false,this,this.perspective,l,null,null);this.dispatchEvent(k)}},getContextVariableValue:function(l){var k=this.perspective.getParameters().getByName(l);return k&&k.getValue()||""}}));this.Widget=h;defaultChrome='<div class="bp-widget Xbp-ui-dragRoot Xbp-ui-dragGrip"><div class="bp-widget-head"></div><div class="bp-widget-pref"></div><div class="bp-widget-body"></div><div class="bp-widget-foot"></div></div>';var g=b$._private.htmlAPI;b$.portal.view.loadChrome=function(r,q){var m={ADMIN:0,CREATOR:-1,COLLABORATOR:-2,CONTRIBUTOR:-3,CONSUMER:-4};var o=r.model;var k={};if(o){k=o.getJSON()}var s=r.getAttribute("widgetChrome");if(s){s=s.replace("$(contextRoot)",b$.portal.portalModel.serverURL);k.widgetTitle=r.getAttribute("title");var n=c(s)}else{var n=defaultChrome}if(o){var l=m[o.securityProfile];k.showEdit=l>=m.CONTRIBUTOR;k.showDelete=l>=m.CREATOR;k.enableDND=l>=m.CONTRIBUTOR;k.showMaximize=true}var p=g.createElementFromString(Mustache.to_html(n,k),q);return p}});b$.module("b$.portal.view.bdom.widget.backbase",function(){var d=b$.bdom.getNamespace("http://backbase.com/2012/portalView");var h=d.getClass("widget");var e=b$.view.perspective.PerspectiveType;var a=b$.view.perspective.PerspectiveParameters;var f=b$.view.perspective.Perspective;var i=b$._private.template.SimpleURITemplate;var g=b$._private.htmlAPI;var b=new b$._private.AsyncComponentBuilder();var c=d.registerElement("backbaseWidget",h.extend(function(l,k,j,m){h.apply(this,arguments)},{buildHTML:function(k){var j=document;if(!k){k=b$.portal.view.loadChrome(this,j)}else{this.htmlNode=k}this.bindChromeHandlers();this.htmlHead=g.cssSelector(".bp-widget-head",k)[0];this.htmlFoot=g.cssSelector(".bp-widget-foot",k)[0];this.htmlAreas=[];this.htmlAreas[0]=g.cssSelector(".bp-widget-body",k)[0];this.body=this.htmlAreas[0];this.isClientSideRenderedOnly=!(this.body&&this.body.firstChild);if(this.model.isWidgetRenderingTriggeredByDragAndDropFromTargeting||this.isClientSideRenderedOnly){this.buildWidgetByDefinition()}else{this.buildWidget()}return k},readyHTML:function(){h.prototype.readyHTML.call(this)},updateByDefinition:function(j){b.buildWidget(this.myDefinition.sUrl,true,this,function(n){if(this.processed){if(j){j()}return}this.myDefinition=n;this.includes=n.getIncludesFromDefinition(this);n.getPreferencesFromDefinition(this);if(this.isClientSideRenderedOnly){this.body.appendChild(n.getHTMLBodyFromDefinition())}var m=this.body;var o=g.cssSelector(".bp-g-include",m);if(o.length){for(var l=0;l<this.includes.length;l++){var k=this.includes[l];k.htmlNode=o[l];k.addEventListener("content",function(){this.htmlNode.innerHTML="";for(var p=0;p<this.content.length;p++){this.htmlNode.appendChild(this.content[p])}})}}this.processed=true;if(this.isClientSideRenderedOnly){this.refreshIncludes()}if(j){j()}}.bind(this))},buildWidget:function(m){var k=this.getAttribute("src");k=k.replace("$(contextRoot)",b$.portal.portalModel.serverURL);var j=this;var l=this.model.isWidgetRenderingTriggeredByDragAndDropFromTargeting||this.isClientSideRenderedOnly;b.buildWidget(k,l,j,function(p){var n=p.XListeners;this.myDefinition=p;if(this.model){for(var o in n){if(n.hasOwnProperty(o)){this.model.addEventListener(o,n[o],false,this)}}}this.perspective=new f(new i(k,"page"),new e("Dashboard"),new a());if(n.load){n.load.call(this)}if(m){m()}}.bind(this))},buildWidgetByDefinition:function(){this.buildWidget(this.updateByDefinition.bind(this))},refreshIncludes:function(){for(var k=0,j=this.includes.length;k<j;k++){this.includes[k].refresh()}},getOriginURI:function(){return this.getDefinition().sUrl},getDefinition:function(){return this.myDefinition},getBody:function(){return this},getIncludes:function(){return this.includes}},{handlers:{}}))});b$.module("b$.portal.view.bdom.widget.w3c",function(){var f=b$.bdom.getNamespace("http://backbase.com/2012/portalView");var e=f.getClass("widget");var d=b$._private.htmlAPI;var c=b$.view.perspective.PerspectiveType;var a=b$.view.perspective.PerspectiveParameters;var h=b$.view.perspective.Perspective;var b=b$._private.template.SimpleURITemplate;var g=f.registerElement("w3cWidget",e.extend(function(k,j,i,l){e.apply(this,arguments)},{buildHTML:function(m){if(m){var l=d.cssSelector(".bp-widget-body > iframe",m)[0];var i=this.getAttribute("src");if(!i){i=this.getAttribute("defaultStartFile")}i=i.replace("$(contextRoot)",b$.portal.portalModel.serverURL);l.setAttribute("src",i);this.bindChromeHandlers();this.htmlAreas=[];this.htmlAreas[0]=d.cssSelector(".bp-widget-body",m)[0];this.body=this.htmlAreas[0];this.htmlHead=d.cssSelector(".bp-widget-head",m)[0];this.htmlFoot=d.cssSelector(".bp-widget-foot",m)[0]}else{var k=document;var m=b$.portal.view.loadChrome(this,k);this.htmlAreas=[];this.htmlAreas[0]=d.cssSelector(".bp-widget-body",m)[0];this.body=this.htmlAreas[0];var i=this.getAttribute("src");if(!i){i=this.getAttribute("defaultStartFile")}i=i.replace("$(contextRoot)",b$.portal.portalModel.serverURL);var j=this.model.name;var l=d.createElementFromString('<iframe style="width:100%; height:100%;" frameborder="0"></iframe>',k);l.setAttribute("src",i);l.setAttribute("data-widgetInstanceId",j);this.htmlAreas[0].appendChild(l)}this.perspective=new h(new b(i,"page"),new c("Dashboard"),new a());this.sSrc=i;return m}}))});