"undefined"==typeof window.Mozilla&&(window.Mozilla={}),function(){"use strict";window.dataLayer=window.dataLayer||[];var t={COOKIE_CODE_ID:"moz-stub-attribution-code",COOKIE_SIGNATURE_ID:"moz-stub-attribution-sig",DLSOURCE:"mozorg"};t.experimentName,t.experimentVariation,t.successCallback,t.timeoutCallback,t.requestComplete=!1,t.withinAttributionRate=function(){return Math.random()<t.getAttributionRate()},t.getAttributionRate=function(){var t=document.getElementsByTagName("html")[0].getAttribute("data-stub-attribution-rate");return isNaN(t)||!t?0:Math.min(Math.max(parseFloat(t),0),1)},t.hasCookie=function(){return Mozilla.Cookies.hasItem(t.COOKIE_CODE_ID)&&Mozilla.Cookies.hasItem(t.COOKIE_SIGNATURE_ID)},t.setCookie=function(e){if(e.attribution_code&&e.attribution_sig){var i=new Date;i.setTime(i.getTime()+864e5);var o=i.toUTCString();Mozilla.Cookies.setItem(t.COOKIE_CODE_ID,e.attribution_code,o,"/",undefined,!1,"lax"),Mozilla.Cookies.setItem(t.COOKIE_SIGNATURE_ID,e.attribution_sig,o,"/",undefined,!1,"lax")}},t.getCookie=function(){return{attribution_code:Mozilla.Cookies.getItem(t.COOKIE_CODE_ID),attribution_sig:Mozilla.Cookies.getItem(t.COOKIE_SIGNATURE_ID)}},t.updateBouncerLinks=function(e){if(e.attribution_code&&e.attribution_sig&&t.meetsRequirements())for(var i=document.querySelectorAll(".download-list .download-link, .c-button-download-thanks .download-link, .download-platform-list .download-link"),o=0;o<i.length;o++){var n,a,r=i[o];!r.href||-1===r.href.indexOf("https://download.mozilla.org")&&-1===r.href.indexOf("https://bouncer-bouncer.stage.mozaws.net/")?r.href&&-1!==r.href.indexOf("/firefox/download/thanks/")&&(a=r.getAttribute("data-direct-link"))&&r.setAttribute("data-direct-link",Mozilla.StubAttribution.appendToDownloadURL(a,e)):(n=r.getAttribute("data-download-version"))&&/win/.test(n)&&(r.href=Mozilla.StubAttribution.appendToDownloadURL(r.href,e))}},t.appendToDownloadURL=function(t,e){if(!e.attribution_code||!e.attribution_sig)return t;for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&("attribution_code"!==i&&"attribution_sig"!==i||(t+=(t.indexOf("?")>-1?"&":"?")+i+"="+e[i]));return t},t.onRequestSuccess=function(e){e.attribution_code&&e.attribution_sig&&!t.requestComplete&&(t.updateBouncerLinks(e),t.setCookie(e),t.requestComplete=!0,"function"==typeof t.successCallback&&t.successCallback())},t.onRequestTimeout=function(){t.requestComplete||(t.requestComplete=!0,"function"==typeof t.timeoutCallback&&t.timeoutCallback())},t.requestAuthentication=function(e){var i=window.location.protocol+"//"+window.location.host+"/en-US/firefox/stub_attribution_code/",o=new window.XMLHttpRequest,n=setTimeout(t.onRequestTimeout,1e4);o.open("GET",i+"?"+window._SearchParams.objectToQueryString(e)),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.onreadystatechange=function(){if(4===o.readyState){var e=o.status;if(e&&e>=200&&e<400)try{var i=JSON.parse(o.responseText);clearTimeout(n),t.onRequestSuccess(i)}catch(a){t.onRequestTimeout()}}},o.timeout=1e4,o.send()},t.getUserAgent=function(t){return t=void 0!==t?t:navigator.userAgent,/MSIE|Trident/i.test(t)?"ie":/Edg|Edge/i.test(t)?"edge":/Firefox/.test(t)?"firefox":/Chrome/.test(t)?"chrome":"other"},t.getGAClientID=function(){try{var t=window.ga.getAll()[0].get("clientId");return t&&"string"==typeof t&&""!==t?t:null}catch(e){return null}},t.createSessionID=function(){return Math.floor(1e9+9e9*Math.random()).toString()},t.waitForGoogleAnalytics=function(e){var i,o=0;!function n(){clearTimeout(i),t.getGAClientID()?e(!0):o<=20?(o+=1,i=window.setTimeout(n,100)):e(!1)}()},t.getAttributionData=function(e){var i=new window._SearchParams,o=i.utmParams(),n=i.get("experiment")||t.experimentName,a=i.get("variation")||t.experimentVariation,r=void 0!==e?e:document.referrer,u=t.getUserAgent(),s=t.getGAClientID(),l={utm_source:o.utm_source,utm_medium:o.utm_medium,utm_campaign:o.utm_campaign,utm_content:o.utm_content,referrer:r,ua:u,experiment:n,variation:a,client_id:s,session_id:s?t.createSessionID():null,dlsource:t.DLSOURCE};for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&("undefined"!=typeof l[d]&&null!==l[d]||delete l[d]);return l},t.hasValidData=function(t){if("string"==typeof t.utm_content&&"string"==typeof t.referrer){var e=t.utm_content;if(e.length>150)return!1;for(;-1!==e.indexOf("%");)try{var i=decodeURIComponent(e);if(i===e)break;e=i}catch(o){break}if(/^rta:/.test(e)&&-1===t.referrer.indexOf("https://addons.mozilla.org"))return!1}return!0},t.isFirefoxNewScene2=function(t){return(t=void 0!==t?t:window.location.href).indexOf("/firefox/download/thanks/")>-1},t.meetsRequirements=function(){return"undefined"!=typeof window.site&&"undefined"!=typeof Mozilla.Cookies&&"undefined"!=typeof window._SearchParams&&!!Mozilla.Cookies.enabled()&&"windows"===window.site.platform&&!Mozilla.dntEnabled()},t.init=function(e,i){var o={};t.meetsRequirements()&&("function"==typeof e&&(t.successCallback=e),"function"==typeof i&&(t.timeoutCallback=i),t.hasCookie()?(o=t.getCookie(),t.updateBouncerLinks(o)):t.isFirefoxNewScene2()||t.waitForGoogleAnalytics((function(){(o=t.getAttributionData())&&t.withinAttributionRate()&&t.hasValidData(o)&&(t.requestAuthentication(o),o.client_id&&o.session_id&&window.dataLayer.push({event:"stub-session-id",eLabel:o.session_id}))})))},window.Mozilla.StubAttribution=t}(),function(){"use strict";Mozilla.StubAttribution.init()}();