"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[13951],{313951:function(e,t,n){n.d(t,{i5:function(){return D},sX:function(){return P},aX:function(){return I},Z5:function(){return T},NG:function(){return M},MT:function(){return j},iu:function(){return k}});var r=n(76911),a=n(214494),o=n(425288),s=n(505920),u=n(16449),i=n.n(u);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var v=function(e,t){return e.data[t]&&e.data[t].messages||[]};function y(e,t){var n={};return e.filter((function(e){return!!e})).reduce((function(e,r){var a=t(r);return n[a]?(i()(n[a],r),e):(n[a]=r,e.concat([r]))}),[])}function E(e){return p(e).sort((function(e,t){return new Date(e.created_ms||e.created_at)-new Date(t.created_ms||t.created_at)}))}function _(e,t,n){return E(y(v(e,t).concat(n),(function(e){return e.id})))}var O={conversationsUnseenCount:0,data:{},newsHubCount:0,open:null,objectAttachment:null,showConversationsDropdown:!1,showNewMessageView:!1,ui:{},unread:0};function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,t=arguments.length>1?arguments[1]:void 0;if("CONVERSATION_OPEN"===t.type)return d(d({},e),{},{open:t.payload.id,objectAttachment:null,showNewMessageView:!1,ui:d(d({},e.ui),{},l({},t.payload.id,{contactRequestId:t.payload.contactRequestId||"",isPreview:t.payload.isPreview}))});if("CONVERSATION_CLOSE"===t.type)return d(d({},e),{},{open:null,objectAttachment:null,showNewMessageView:!1,ui:d(d({},e.ui),{},l({},t.payload.id,{contactRequestId:t.payload.contactRequestId||"",isPreview:!1,isDeclined:t.payload.isDeclined}))});if("CONVERSATION_CREATE"===t.type){var n=t.payload.id;return d(d({},e),{},{data:d(d({},e.data),{},l({},n,d(d({},e.data[n]||{}),t.payload)))})}if("CONVERSATION_DELETE"===t.type){var r=d(d({},e),{},{data:d({},e.data)}),a=t.payload.id;return delete r.data[a],r}if("FETCH_COMPLETE"===t.type){var o=t.payload,s=o.options,u=o.resource,i=o.response.resource_response.data;if("ConversationMessagesResource"===u){var c=i||[],f=(null==s?void 0:s.conversation_id)||"",C=_(e,f,c),m=C[C.length-1];return d(d({},e),{},{data:d(d({},e.data),{},l({},f,d(d({},e.data[f]),{},{id:f,messages:C,unread:0,last_message:m})))})}if("ConversationsResource"===u){var g=i||[],b=d(d({},e),{},{data:d({},e.data)});return g.forEach((function(e){var t=e.id,n=e.created_at,r=e.name,a=e.board,o=e.emails,s=e.unread,u=e.users,i=e.last_message,c=_(b,t,[i]);b.data[t]=d(d({},b.data[t]),{},{id:t,created_at:n,name:r,board:a,emails:o||[],unread:s||0,users:u||[],last_message:i,messages:c})})),b}if("ConversationResource"===u){var N=i||{},A=N.id,S=d(d({},e),{},{data:d({},e.data)});return A&&(S.data[A]=d(d({},S.data[A]),N)),S}if("NewsHubBadgeResource"===u){if(i){var w=i.conversations_unseen_count||0;return d(d({},e),{},{unread:w})}return e}}else{if("MESSAGE_SEND_PENDING"===t.type){var h=t.payload,R=h.id,T=h.message;return e.data[R]?d(d({},e),{},{data:d(d({},e.data),{},l({},R,d(d({},e.data[R]),{},{id:R,messages:[].concat(p(e.data[R].messages),[T])})))}):e}if("MESSAGE_SEND_PENDING_SUCCESS"===t.type){var D=t.payload,I=D.id,M=D.tempMessage,P=D.newMessage;if(e.data[I])if(v(e,I).find((function(e){return e.id===M.id&&e.created_ms===M.created_ms}))){var j=E(y(v(e,I).filter((function(e){return e.id!==M.id})).concat([P]),(function(e){return e.id})));return d(d({},e),{},{data:d(d({},e.data),{},l({},I,d(d({},e.data[I]),{},{last_message:P,messages:j})))})}return e}if("MESSAGE_SEND_PENDING_FAILURE"===t.type){var k=t.payload,U=k.id,V=k.tempMessageId;if(e.data[U]){var x=v(e,U).filter((function(e){return e.id!==V}));return d(d({},e),{},{data:d(d({},e.data),{},l({},U,d(d({},e.data[U]),{},{messages:x})))})}return e}if("OPEN_NEW_MESSAGE"===t.type){var G=(t.payload||null).objectAttachment;return d(d({},e),{},{showNewMessageView:!0,open:null,objectAttachment:G})}if("CLOSE_DROPDOWN"===t.type)return d(d({},e),{},{showConversationsDropdown:!1,objectAttachment:null,showNewMessageView:!1});if("OPEN_DROPDOWN"===t.type)return d(d({},e),{},{showConversationsDropdown:!0});if("UPDATE_NEWSHUB_COUNT"===t.type)return d(d({},e),{},{newsHubCount:t.payload});if("UPDATE_UNREAD_COUNT"===t.type)return d(d({},e),{},{conversationsUnseenCount:t.payload});if("CLEAR_MESSAGE_BADGE"===t.type){var L=t.payload.id;return d(d({},e),{},{data:d(d({},e.data),{},l({},L,d(d({},e.data[L]),{},{unread:0})))})}if("CONVERSATION_SAVE_POSITION"===t.type){var H=t.payload,B=H.id,Z=H.position;return d(d({},e),{},{data:d(d({},e.data),{},l({},B,d(d({},e.data[B]),{},{position:Z})))})}if("CONVERSATION_RESET_POSITION"===t.type){var W=t.payload.id;return d(d({},e),{},{data:d(d({},e.data),{},l({},W,d(d({},e.data[W]),{},{position:null})))})}if("SET_OBJECT_ATTACHMENT"===t.type){var q=t.payload.objectAttachment;return d(d({},e),{},{objectAttachment:q})}if("REMOVE_OBJECT_ATTACHMENT"===t.type)return d(d({},e),{},{objectAttachment:null})}return e}var m=n(515198);function g(e,t,n,r,a,o,s){try{var u=e[o](s),i=u.value}catch(c){return void n(c)}u.done?t(i):Promise.resolve(i).then(r,a)}function b(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){g(o,r,a,s,u,"next",e)}function u(e){g(o,r,a,s,u,"throw",e)}s(void 0)}))}}function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],s=!0,u=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);s=!0);}catch(i){u=!0,a=i}finally{try{s||null==n.return||n.return()}finally{if(u)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var S,w=(S=0,function(){return S++}),h=(0,o.Z)("Conversations"),R=h.Provider,T=h.useHook;function D(e){var t=e.children,n=N((0,r.useReducer)(C,O),2),o=n[0],u=n[1],i=(0,r.useCallback)((function(e){return u({type:"FETCH_COMPLETE",payload:e})}),[]);(0,s.Z8)("ConversationMessagesResource",i),(0,s.my)("ConversationMessagesResource",i),(0,s.Z8)("ConversationsResource",i),(0,s.Z8)("ConversationResource",i),(0,s.Z8)("NewsHubBadgeResource",i);var c=(0,r.useCallback)((function(e){return u({type:"CONVERSATION_OPEN",payload:{id:e,isPreview:arguments.length>1&&void 0!==arguments[1]&&arguments[1],contactRequestId:arguments.length>2&&void 0!==arguments[2]?arguments[2]:""}})}),[]),d=(0,r.useCallback)((function(e){return u({type:"CONVERSATION_CLOSE",payload:{id:e,contactRequestId:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",isDeclined:arguments.length>2&&void 0!==arguments[2]&&arguments[2]}})}),[]),l=(0,r.useCallback)((function(e){return u({type:"CONVERSATION_CREATE",payload:e})}),[]),p=(0,r.useCallback)((function(e){return u({type:"CONVERSATION_DELETE",payload:{id:e}})}),[]),f=(0,r.useCallback)((function(e,t){return u({type:"CONVERSATION_SAVE_POSITION",payload:{id:e,position:t}})}),[]),v=(0,r.useCallback)((function(e){return u({type:"CONVERSATION_RESET_POSITION",payload:{id:e}})}),[]),y=(0,r.useCallback)((function(e,t,n){a.Z.create("ConversationsResource",{user_ids:e,emails:t,text:""}).callCreate().then((function(e){var t=e&&e.resource_response.data;u({type:"CONVERSATION_OPEN",payload:{id:t.id}})})).catch((function(e){var t=e.message_detail||e.message||"";n(t)}))}),[]),E=(0,r.useCallback)((function(){u({type:"CLOSE_DROPDOWN"})}),[]),_=(0,r.useCallback)((function(){u({type:"OPEN_DROPDOWN"})}),[]),g=(0,r.useCallback)((function(e){u({type:"OPEN_NEW_MESSAGE",payload:{objectAttachment:e}})}),[]),b=(0,r.useCallback)((function(e,t){return u({type:"MESSAGE_SEND_PENDING",payload:{id:e,message:t}})}),[]),A=(0,r.useCallback)((function(e,t,n){return u({type:"MESSAGE_SEND_PENDING_SUCCESS",payload:{id:e,tempMessage:t,newMessage:n}})}),[]),S=(0,r.useCallback)((function(e,t){return u({type:"MESSAGE_SEND_PENDING_FAILURE",payload:{id:e,tempMessageId:t}})}),[]),w=(0,r.useCallback)((function(e){return u({type:"UPDATE_NEWSHUB_COUNT",payload:e})}),[]),h=(0,r.useCallback)((function(e){return u({type:"UPDATE_UNREAD_COUNT",payload:e})}),[]),T=(0,r.useCallback)((function(e){return u({type:"CLEAR_MESSAGE_BADGE",payload:{id:e}})}),[]),D=(0,r.useCallback)((function(e){return u({type:"SET_OBJECT_ATTACHMENT",payload:{objectAttachment:e}})}),[]),I=(0,r.useCallback)((function(){return u({type:"REMOVE_OBJECT_ATTACHMENT"})}),[]),M=(0,r.useMemo)((function(){return{clearMessageBadge:T,conversationOpen:c,conversationClose:d,conversationCreate:l,conversationDelete:p,conversationGet:y,saveConversationPosition:f,resetConversationPosition:v,dropdownClose:E,dropdownOpen:_,newMessageOpen:g,pendingMessageSend:b,pendingMessageSuccess:A,pendingMessageFailure:S,updateNewsHubCount:w,updateUnreadCount:h,conversations:o,setObjectAttachment:D,removeObjectAttachment:I}}),[T,c,d,l,p,y,f,v,E,_,g,b,A,S,w,h,o,D,I]);return(0,m.jsx)(R,{value:M,children:t})}function I(){var e=T().conversationCreate;return function(){var t=b(regeneratorRuntime.mark((function t(n){var r,o,s,u,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=a.Z.create("ConversationsResource",n),t.prev=1,t.next=4,o.callCreate();case 4:u=t.sent,(i=null===(s=u.resource_response)||void 0===s?void 0:s.data)&&(e(i),r=i),t.next=12;break;case 9:throw t.prev=9,t.t0=t.catch(1),new Error(t.t0.message);case 12:return t.abrupt("return",r);case 13:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e){return t.apply(this,arguments)}}()}function M(){var e=T(),t=e.conversations,n=e.conversationCreate,r=e.pendingMessageSend,o=e.pendingMessageSuccess,s=e.pendingMessageFailure;return function(){var e=b(regeneratorRuntime.mark((function e(u,i,c,d){var l,p,f,v,y,E,_,O,C,m,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_=function(){return(_=b(regeneratorRuntime.mark((function e(){var t,n,i,E,_,O;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.Z.create("ConversationMessagesResource",{conversation_id:u,text:l,pin:p,board:f,user:v,user_did_it_data:y,source:c}),n="".concat(w()),i={text:l,sender:d,created_at:(new Date).toString(),created_ms:Date.now(),id:n,type:"tempMessage"},r(u,i),e.prev=4,e.next=7,t.callCreate();case 7:_=e.sent,(O=null===(E=_.resource_response)||void 0===E?void 0:E.data)&&o(u,i,O),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(4),s(u,n),new Error(e.t0.message);case 16:case"end":return e.stop()}}),e,null,[[4,12]])})))).apply(this,arguments)},E=function(){return _.apply(this,arguments)},l=i.text,p=i.pinId,f=i.boardId,v=i.userId,y=i.didItId,t.data[u]){e.next=21;break}return O=a.Z.create("ConversationResource",{conversation_id:u}),e.prev=5,e.next=8,O.callGet();case 8:if(m=e.sent,!(g=null===(C=m.resource_response)||void 0===C?void 0:C.data)){e.next=14;break}return n(g),e.next=14,E();case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(5),new Error(e.t0.message);case 19:e.next=23;break;case 21:return e.next=23,E();case 23:case"end":return e.stop()}}),e,null,[[5,16]])})));return function(t,n,r,a){return e.apply(this,arguments)}}()}function P(e){return T().conversations.data[e]}function j(e){return T().conversations.ui[e]||{contactRequestId:"",isDeclined:!1,isPreview:!1}}function k(){var e,t,n=T().conversations.data,r=(e=n,Object.keys(e).map((function(t){return e[t]}))).filter((function(e){return e.users&&e.last_message}));return t=r,Array.from(t).sort((function(e,t){return new Date((t.last_message||t).created_at)-new Date((e.last_message||e).created_at)}))}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/13951-da4f13e6b9e95c73.js.map