const sdkScriptUri=(()=>{let n="",t=document.currentScript.src;if(t){let i=t.split("/");n=`${i[0]}//${i[2]}`}return n})(),getBffBaseUrl=(()=>{let n="";if(window.location.origin.indexOf("local")>0)return n="-test","https://localhost:44389";if(window.location.origin.indexOf("pilot")>0)n="";else{if(window.location.origin.indexOf("code")>0)return n="-test",`https://voltran-bff${n}.demirorenmedya.com`;window.location.origin.indexOf("test")>0&&(n="-test")}return`https://voltran-bff${n}.demirorenmedya.com`})(),getTemplateBaseUrl=(()=>{let n="";if(window.location.origin.indexOf("local")>0)return n="-test","https://localhost:44389";if(window.location.origin.indexOf("pilot")>0)n="";else{if(window.location.origin.indexOf("code")>0)return n="-test",`https://uyelik-sso1${n}.demirorenmedya.com`;window.location.origin.indexOf("test")>0&&(n="-test")}return`https://uyelik-sso1${n}.demirorenmedya.com`})(),getIdpBaseUrl=(()=>{let n="";return window.location.origin.indexOf("local")>0?n="-test":window.location.origin.indexOf("pilot")>0?n="":window.location.origin.indexOf("test")>0&&(n="-test"),`https://uyelik-sso1${n}.demirorenmedya.com`})(),getSharedCookieStartingDomain=(()=>{let n="www.";return window.location.origin.indexOf("local")>0?(n="test.","https://localhost:44358"):(window.location.origin.indexOf("pilot")>0?n="pilot.":window.location.origin.indexOf("test")>0&&(n="test."),`https://${n}hurriyet.com.tr`)})(),DM={};DM.const={authorityUrl:`${getIdpBaseUrl}`,bffBaseUrl:`${getBffBaseUrl}/api/v1`,dmClientUrl:`${sdkScriptUri}/js/DMCookieStorage.min.js`,clientUrl:`${sdkScriptUri}/js/oidc-client/oidc-client.min.js`,culture:()=>{let n=navigator.language||"tr-TR";return DM.const.text.hasOwnProperty(n)?n:"en-US"},text:{"tr-TR":{signIn:"Giriş Yap",userSessionHasExpired:"Kullanıcının oturumu sona erdi.",sessionHasBeenClosed:"Oturumunuz kapatıldı. Lütfen tekrar giriş yapın.",userNotLoggedIn:"Kullanıcı oturum açmadı.",accessTokenExpired:"Erişim jetonunun süresi dolmuş."},"en-US":{signIn:"Sign In",userSessionHasExpired:"User session has expired.",sessionHasBeenClosed:"Session has been closed.",userNotLoggedIn:"User not logged in.",accessTokenExpired:"Access token expired."}}};DM.common=(()=>{let n=()=>Math.max(...Array.from(document.querySelectorAll("body *"),n=>parseFloat(window.getComputedStyle(n).zIndex)).filter(n=>!Number.isNaN(n)),1),t=(t,i={})=>{i.promise=new Promise((n,t)=>{i.resolve=n,i.reject=t});let r={id:Math.random().toString(36).substr(2,10).replace(/[^a-zA-Z]+/g,""),zindex:n(),...i};r.randomClassName=r.id;r.close=()=>{document.getElementById(r.id).remove(),document.querySelectorAll(`.${r.id}`).forEach(n=>n.remove())};let u=document.getElementById(r.id);if(!u){let n=`<div class="${r.randomClassName} dm-backdrop" style="z-index:${r.zindex}"></div><div class="${r.randomClassName} dm-modal-container" style="z-index:${r.zindex}9"><div id="${r.id}" class="dm-modal">${t}</div></div>`;document.body.insertAdjacentHTML("beforeend",n)}return r},i=async(n,t={})=>{let i=await fetch(n,{mode:"cors",method:"GET",headers:{"Content-Type":"text/html"},...t});return await i.text()},r=async(n,t={},i={})=>{let u={mode:"cors",method:"GET",...i,headers:{Accept:"application/json","Content-Type":"application/json",...i.headers}};t&&typeof t=="object"&&Object.keys(t).length>0&&(u.body=JSON.stringify(t));let r=await fetch(n,u),f=r.status==200?await r.json():await Promise.resolve({hasError:!0,errors:[r.statusText]});return f.status=r.status,f},u=()=>{let n=`<style type="text/css">.dm-backdrop,.dm-modal-container{position:fixed;top:0;left:0;right:0;bottom:0;margin:0;overflow:hidden}.dm-backdrop{background-color:rgba(0,0,0,.5)}.dm-modal-container{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:center;align-items:center;align-content:stretch}.dm-modal-container>.dm-modal{background-color:#fff;padding:15px;border:1px solid #fff;border-radius:6px}.dm-modal-container>.dm-modal .dm-btn{display:inline-block;padding:7px 15px;border-radius:3px;text-decoration:none;border:1px solid}.dm-modal-container>.dm-modal .dm-btn.primary{background-color:#2196f3;border-color:#2196f3;color:#fff}.dm-modal-container>.dm-modal .dm-btn.danger{background-color:red;border-color:red;color:#fff}</style>`;document.head.insertAdjacentHTML("beforeend",n)},f=(n,t=null)=>{let i=document.createElement("script");return i.src=n,i.async=i.defer=!0,t&&(i.onload=()=>t()),document.body.appendChild(i),i},e=(n,t,i=null)=>{let r=document.getElementById(n);return r?r:(iframe=document.createElement("iframe"),iframe.id=n,iframe.style.display=`none`,iframe.src=t,iframe.async=iframe.defer=!0,i&&(iframe.onload=()=>i()),document.body.appendChild(iframe),iframe)};return{load:i,getJSON:r,loadCss:u,modal:t,createElement:{script:f,iframe:e}}})();DM.oidc={storage:{},localStorage:{get:()=>{let n=document.cookie.split("; ");if(n.length>1){let t=n.find(n=>n.startsWith(".DM.SharedCookie"));if(t){let n=JSON.parse(t.split("=")[1]);return{token_type:n.token_type,access_token:n.access_token}}}return null}},config:{},userManager:{},storageManager:{get:()=>{let n=DM.oidc.storage.getItem(`oidc.user:${sdkScriptUri}:${DM.oidc.config.client_id}`);return DM.oidc.config.storage=="cookie"?n:JSON.parse(n||"null")},update:n=>{let t=DM.oidc.config.storage=="cookie"?n:JSON.stringify(n||"null");return DM.oidc.storage.setItem(`oidc.user:${sdkScriptUri}:${DM.oidc.config.client_id}`,t),DM.oidc.storageManager.get()},"delete":()=>(DM.oidc.storage.removeItem(`oidc.user:${sdkScriptUri}:${DM.oidc.config.client_id}`),DM.oidc.storageManager.get())},loadScript:()=>{switch(DM.oidc.config.storage){case"cookie":DM.common.createElement.script(DM.const.dmClientUrl,function(){DM.oidc.storage=typeof DMCookieStorage!="undefined"?new DMCookieStorage:new InMemoryWebStorage;DM.common.createElement.script(DM.const.clientUrl,DM.oidc.onScriptLoaded)});break;case"nostorage":DM.auth.oidc.checkDMSharedCookie();break;default:DM.oidc.storage=typeof window!="undefined"?window.localStorage:new InMemoryWebStorage;DM.common.createElement.script(DM.const.clientUrl,DM.oidc.onScriptLoaded)}},onScriptLoaded:()=>{DM.oidc.config.userStore=new Oidc.WebStorageStateStore({store:DM.oidc.storage});DM.oidc.userManager=new Oidc.UserManager(DM.oidc.config);DM.oidc.isUserLoggedIn();DM.oidc.eventHandler();DM.oidc.config.onmessagereceived({data:"oidcScriptLoaded"})},eventHandler:()=>{DM.oidc.userManager.events.addAccessTokenExpired(()=>{DM.oidc.userManager.removeUser();DM.oidc.isUserLoggedIn();DM.oidc.config.onmessagereceived({data:"addAccessTokenExpired"});DM.oidc.config.onfailure({message:DM.const.text[DM.const.culture()].accessTokenExpired})}),DM.oidc.userManager.events.addUserSignedOut(()=>{let n=n=>{DM.oidc.config.onmessagereceived({data:"addUserSignedOut"});DM.oidc.config.onfailure({message:n});DM.oidc.userManager.removeUser();DM.oidc.config.sessionExpiredModal&&DM.auth.sessionExpiredModal({button:{text:DM.const.text[DM.const.culture()].signIn,href:"javascript:DM.auth.oidc.signIn();"}})};DM.oidc.userManager.getUser().then(function(t){t&&DM.auth.getUserInfo(t).then(t=>{if(t.status==401){DM.oidc.userManager.revokeAccessToken();DM.oidc.userManager.removeUser();DM.oidc.config.onfailure({message:DM.const.text[DM.const.culture()].userNotLoggedIn})}else t.hasError?n(t.errors.join(".")):t.result==null&&n(DM.const.text[DM.const.culture()].userNotLoggedIn)})})}),DM.oidc.userManager.events.addUserLoaded(()=>{console.info("addUserLoaded")}),DM.oidc.userManager.events.addUserUnloaded(()=>{console.info("addUserUnloaded")}),DM.oidc.userManager.events.addAccessTokenExpiring(()=>{console.info("addAccessTokenExpiring")}),DM.oidc.userManager.events.addAccessTokenExpired(()=>{console.info("addAccessTokenExpired")}),DM.oidc.userManager.events.addSilentRenewError(n=>{console.info("addSilentRenewError:",n)})},isUserLoggedIn:()=>{let n=DM.oidc.storageManager.get();return n?DM.oidc.userManager.getUser().then(n=>{DM.oidc.onUserLoggedIn(n)}):DM.oidc.userManager.signinSilent().then(n=>{n&&DM.auth.getUserInfo(n).then(async t=>{if(t.hasError)DM.oidc.onUserLoggedIn(n);else{let i=t.result.tenantDetails.find(n=>n.tenantName==DM.oidc.config.acr_values);if(i)if(i.hasKvvkPermission==!1)DM.auth.kvkkModal(n).then(t=>{n.profile.is_kvvk=!0;DM.oidc.storageManager.update(n);t.close();DM.oidc.onUserLoggedIn(n);DM.auth.kvkkApprove(n)});else DM.oidc.onUserLoggedIn(n)}})},()=>{}),n||null},onUserLoggedIn:async n=>{if(n){DM.auth.getUserInfo(n).then(async t=>{if(!t.hasError){let i=t.result.tenantDetails.find(n=>n.tenantName==DM.oidc.config.acr_values);i&&i.hasETKPermission==!1&&await DM.auth.etkModal(n).then(t=>{let i=document.getElementsByName("etkCampaign");if(i){let t=i[0].checked;n.profile.is_etk=!0;DM.oidc.storageManager.update(n);DM.auth.etkApprove(n,t,t,t)}t.close()},t=>{n.profile.is_etk=!1,DM.oidc.storageManager.update(n),t.close(),DM.auth.etkApprove(n)})}});DM.oidc.config.onsuccess({data:n})}else DM.oidc.config.onfailure({message:DM.const.text[DM.const.culture()].userNotLoggedIn})},startCheckSession:()=>{window.addEventListener("message",n=>{if(n.origin==DM.const.authorityUrl){DM.oidc.config.onmessagereceived({e:n,data:n.data});n.data=="changed"&&DM.oidc.userManager.signinSilent().then(n=>{if(n)DM.oidc.config.onsuccess({data:n});else DM.oidc.config.onfailure({message:DM.const.text[DM.const.culture()].userNotLoggedIn})},t=>{DM.oidc.config.onmessagereceived({e:n,data:"login_required",error:t});DM.auth.sessionExpiredModal({button:{text:DM.const.text[DM.const.culture()].signIn,href:"javascript:DM.auth.oidc.signIn();"}})})}},!1)},createCheckSessionIframe:n=>DM.common.createElement.iframe(n,`${DM.const.authorityUrl}/connect/checksession`)};DM.auth={clickElement:null,oidc:{signOut:()=>{DM.oidc.config.type=="redirect"?DM.oidc.userManager.signoutRedirect().then(()=>{DM.oidc.userManager.revokeAccessToken(),DM.oidc.userManager.removeUser()}):DM.oidc.config.type=="popup"&&DM.oidc.userManager.signoutPopup().then(()=>{DM.oidc.userManager.revokeAccessToken(),DM.oidc.userManager.removeUser()})},signIn:()=>{DM.oidc.config.storage=="nostorage"?window.location=`${getSharedCookieStartingDomain}/accounts/login?lastUrl=${window.location.href}`:(DM.oidc.storage.setItem("DM:oidc:returnUrl",window.location),DM.oidc.config.type==="redirect"?DM.oidc.userManager.signinRedirect({state:DM.oidc.config.state,useReplaceToNavigate:!0,extraQueryParams:{currentURL:window.location.href}}):DM.oidc.config.type==="popup"&&DM.oidc.userManager.signinPopup({state:DM.oidc.config.state}))},checkSession:n=>{let t={iframe_id:"check-session-iframe",client_id:null,session_state:null,onmessagereceived:null,timeout:5e3,...n};if(t.client_id&&t.session_state){let n=DM.oidc.createCheckSessionIframe(t.iframe_id);n&&(n.onload=()=>{setInterval(()=>{let i=`${t.client_id} ${t.session_state}`,r=n.contentWindow;r.postMessage(i,DM.const.authorityUrl)},t.timeout)},window.addEventListener("message",n=>{if(n.origin==DM.const.authorityUrl&&t.onmessagereceived)t.onmessagereceived({e:n,data:n.data})},!1));t.iframe=n}return t},checkDMSharedCookie:()=>{let n=async(n,t)=>{t&&t.hasETKPermission==!1&&await DM.auth.etkModal(n).then(t=>{let i=document.getElementsByName("etkCampaign");if(i){let t=i[0].checked;DM.auth.etkApprove(n,t,t,t)}t.close()},t=>{t.close(),DM.auth.etkApprove(n)})},t=document.cookie.split("; ");if(t.length>1){let i=t.find(n=>n.startsWith(".DM.SharedCookie"));if(i){let r=JSON.parse(i.split("=")[1]),t={token_type:r.token_type,access_token:r.access_token};DM.auth.getUserInfo(t).then(i=>{if(i)if(!i.hasError&&i.result){t.profile={full_name:`${i.result.firstName} ${i.result.lastName}`,...i.result};let r=i.result.tenantDetails.find(n=>n.tenantName==DM.oidc.config.acr_values);if(r)if(r.hasKvvkPermission==!1)DM.auth.kvkkModal(t).then(i=>{i.close();t.data=t;DM.oidc.config.onsuccess(t);n(t,r);DM.auth.kvkkApprove(t)});else{t.data=t;DM.oidc.config.onsuccess(t);n(t,r)}}else DM.oidc.config.onfailure({message:DM.const.text[DM.const.culture()].userNotLoggedIn});else DM.oidc.config.onfailure({message:DM.const.text[DM.const.culture()].userNotLoggedIn})})}else DM.oidc.config.onfailure({message:DM.const.text[DM.const.culture()].userNotLoggedIn})}else DM.oidc.config.onfailure({message:DM.const.text[DM.const.culture()].userNotLoggedIn})},init:(n,t)=>(DM.oidc.config={state:Math.random().toString(36).substr(2,10).replace(/[^a-zA-Z]+/g,""),type:"redirect",authority:DM.const.authorityUrl,client_id:"mvc",response_type:"code",scope:"openid profile offline_access api1",storage:"nostorage",redirect_uri:`${window.location.origin}/callback.html`,popup_redirect_uri:`${window.location.origin}/callback-popup.html`,silent_redirect_uri:`${window.location.origin}/silent.html`,post_logout_redirect_uri:window.location.origin,sessionExpiredModal:!1,automaticSilentRenew:!1,monitorSession:!0,loadUserInfo:!0,revokeTokenTypes:["access_token","refresh_token"],revokeAccessTokenOnSignout:!1,filterProtocolClaims:!1,onsuccess:n=>n,onfailure:n=>n,onmessagereceived:n=>n,...t},DM.common.loadCss(),DM.oidc.loadScript(),DM.auth.clickElement=document.getElementById(n),DM.auth.clickElement&&DM.auth.clickElement.addEventListener("click",DM.auth.oidc.signIn),DM)},sessionExpiredModal:n=>{let t={title:DM.const.text[DM.const.culture()].userSessionHasExpired,text:DM.const.text[DM.const.culture()].sessionHasBeenClosed,button:{text:DM.const.text[DM.const.culture()].signIn,href:"/Account/SignIn"},...n};return DM.common.modal(`<h1>${t.title}</h1><p>${t.text}</p><div><a class="dm-btn primary" href="${t.button.href}">${t.button.text}</a></div>`,t)},etkModal:async n=>{let i=await DM.common.load(`${getTemplateBaseUrl}/templates/Etk.html`);i=i.replace("$full_name",n.profile.full_name);let t=DM.common.modal(i),r=document.getElementById("btn-etk-approve");r&&r.addEventListener("click",()=>{t.resolve(t)});let u=document.getElementById("btn-etk-cancel");return u&&u.addEventListener("click",()=>{t.reject(t)}),t.promise},etkApprove:async(n,t=false,i=false,r=false)=>await DM.common.getJSON(`${DM.const.bffBaseUrl}/${DM.oidc.config.acr_values}/User/ChangeUserEtk`,{permissionForSms:t,permissionForEmail:i,permissionForPhone:r},{method:"POST",headers:{Authorization:`${n.token_type} ${n.access_token}`}}),kvkkModal:async n=>{let t=await DM.common.load(`${getTemplateBaseUrl}/templates/Kvkk.html`);t=t.replace("$full_name",n.profile.full_name);let i=DM.common.modal(t),r=document.getElementById("btn-kvkk-approve");return r&&document.getElementById("btn-kvkk-approve").addEventListener("click",()=>{i.resolve(i)}),i.promise},kvkkApprove:async n=>await DM.common.getJSON(`${DM.const.bffBaseUrl}/${DM.oidc.config.acr_values}/Auth/ConfirmKvkkUserContract`,{},{method:"POST",headers:{Authorization:`${n.token_type} ${n.access_token}`}}),getUserInfo:async n=>await DM.common.getJSON(`${DM.const.bffBaseUrl}/${DM.oidc.config.acr_values}/Auth/GetUserInfo`,{},{headers:{Authorization:`${n.token_type} ${n.access_token}`}})};DM.package={hasUserPackage:async(n,t)=>new Promise(async(i,r)=>{const f=new AbortController,e=setTimeout(()=>{f.abort(),r({hasPackage:!1,expiryDate:null})},3e3);let u=await DM.common.getJSON(`${DM.const.bffBaseUrl}/${DM.oidc.config.acr_values}/Package/HasUserPackage?subBrandName=${t}`,{},{signal:f.signal,method:"GET",headers:{Authorization:`${n.token_type} ${n.access_token}`}});clearTimeout(e);u==null||u.hasError||i({hasPackage:u!=null?u.result.hasPackage:!1,expiryDate:u!=null?u.result.expireDate:null});r({hasPackage:!1,expiryDate:null})})};