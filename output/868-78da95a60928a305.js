"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[868],{30868:function(e,r,t){t.d(r,{x:function(){return te},Q:function(){return oe}});var n=t(59499),o=t(85893),i=t(67294),a=t(52683),s=t(17619),l=t(19521),c=t(56947),f=t.n(c),d=t(20041),u=t(89939),p=t(4730),O=t(97604),v=t(28235),g=t(50667);const m=["className","data-test","hasWarning","isConfirmed","isFullWidth","isPending","onClick","size"];function h(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function E(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?h(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const _=(0,i.forwardRef)(((e,r)=>{let{className:t,"data-test":n,hasWarning:i,isConfirmed:a,isFullWidth:s,isPending:l,onClick:c,size:d}=e,u=(0,p.Z)(e,m);const h="sm"===d?f().font.size.text.medium:f().font.size.text.base;return(0,o.jsx)(g.i,E(E({confirmedText:"Offer saved",initialText:"Save offer",warningText:"Offer not saved. Try again"},u),{},{className:t,"data-test":n,hasWarning:i,isConfirmed:a,isFullWidth:s,isPending:l,onClick:c,ref:r,renderLeadingConfirmed:(0,o.jsx)(O.i,{fill:f().colors.palette.green.light,size:h}),renderLeadingInitial:(0,o.jsx)(v.b,{fill:f().colors.palette.white,size:h}),size:d}))}));_.displayName="ButtonOffer";const y=(0,l.ZP)(_).withConfig({displayName:"ButtonOfferSecondary",componentId:"sc-272k6x-0"})(["button{","}"],(({isConfirmed:e})=>e?`\n      ${u.QJ}\n\n      &:hover {\n        ${u.Ky}\n      }\n\n      &:active {\n        ${u.BH}\n      }\n      svg stop {\n        stop-color: ${f().colors.palette.green.light};\n      }\n  `:`\n      font-weight: normal;\n      ${d._f}\n\n      &:hover {\n        ${d.ID}\n      }\n\n      &:active {\n        ${d.h5}\n        [data-icon-name="NavigationPlusFill"] {\n          fill: ${f().colors.palette.white};\n        }\n        svg stop {\n          stop-color: ${f().colors.palette.white};\n        }\n      }\n      [data-icon-name="NavigationPlusFill"] {\n        fill: ${f().colors.palette.black};\n      }\n      svg stop {\n        stop-color: ${f().colors.palette.gray.medium};\n      }\n    `));y.displayName="ButtonOfferSecondary";var b=t(55139),R=t(77110),F=t(61854),I=t(96431),w=t(44350),A=t(47052);const P=async e=>{const{apis:{loyaltyGuestOfferLists:r},baseUrl:t,circleOfferLoyaltyKeys:n}=(0,w.config)().services.apiPlatform,o=`${t}/${r.endpointPaths.postOfferV1}/${null===e||void 0===e?void 0:e.offerId}`,{data:i,ok:a,statusText:s}=await(0,A.v_)(o,{headers:{Authorization:n.loyaltyClientKey,"x-api-key":n.loyaltyApiKey},parameters:{location_id:null===e||void 0===e?void 0:e.storeId},errorTag:"circle_post_offer_error",timerTag:"circle_post_offer_call",credentials:"include"});if(a)return i;throw new Error(`${s}`)},{useMutation:D}=(0,I.F)({name:"@web/domain-circle-offers/post-offer-v1",mutationFn:e=>P(e)}),S=["LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED"],{useMutation:j}=(0,I.F)({name:"@web/domain-circle-offers/post-offer-v16",mutationFn:e=>{const r=null!==e&&void 0!==e?e:{},{LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:t=!1}=r,n=(0,p.Z)(r,S);return(0,w.flags)("LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED")||t?P(n):(async e=>{const{apis:{offersV16:r},baseUrl:t}=(0,w.config)().services.circle,n=new URL(`${t}/${r.endpointPaths.postOfferV16}/${null===e||void 0===e?void 0:e.offerId}`).toString(),{data:o,ok:i,statusText:a}=await(0,A.v_)(n,{errorTag:"circle_post_offer_error",timerTag:"circle_post_offer_call",credentials:"include"});if(i)return o;throw new Error(`${a}`)})(n)}}),k=async e=>{const{apis:{loyaltyGuestOfferLists:r},circleOfferLoyaltyKeys:t,baseUrl:n}=(0,w.config)().services.apiPlatform,o=`${n}/${r.endpointPaths.deleteOfferV1}/${null===e||void 0===e?void 0:e.offerId}`,{data:i,ok:a,statusText:s}=await(0,A.IV)(o,{headers:{Authorization:t.loyaltyClientKey,"x-api-key":t.loyaltyApiKey},errorTag:"circle_delete_offer_error",timerTag:"circle_delete_offer_call",credentials:"include"});if(a)return i;throw new Error(`${s}`)},{useMutation:L}=(0,I.F)({name:"@web/domain-circle-offers/delete-offer-v1",mutationFn:e=>k(e)}),x=["LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED"],{useMutation:N}=(0,I.F)({name:"@web/domain-circle-offers/delete-offer-v16",mutationFn:e=>{const r=null!==e&&void 0!==e?e:{},{LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:t=!1}=r,n=(0,p.Z)(r,x);return(0,w.flags)("LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED")||t?k(n):(async e=>{const{apis:{offersV16:r},baseUrl:t}=(0,w.config)().services.circle,n=new URL(`${t}/${r.endpointPaths.deleteOfferV16}/${null===e||void 0===e?void 0:e.offerId}`).toString(),{data:o,ok:i,statusText:a}=await(0,A.IV)(n,{errorTag:"circle_delete_offer_error",timerTag:"circle_delete_offer_call",credentials:"include"});if(i)return o;throw new Error(`${a}`)})(n)}}),T="removed",C=T,M="loading",$="added";var V=t(59746),z=t(67300),B=t(6153),Y=t(38927);function G(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function K(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?G(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):G(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var J=t(86235);var Z=t(78503),U=t(28794),W=t(13347);const H=({isPopoverOpen:e,offerButtonRef:r,setIsPopoverOpenToggle:t,isErrorState:n,errorMessage:a="Something went wrong. Try refreshing the page.",isIconOnly:s})=>{const l=(0,i.useRef)(null),c=(0,i.useCallback)((()=>{var e;null===(e=l.current)||void 0===e||e.focus()}),[]),f=(0,i.useCallback)((e=>{null===e||void 0===e||e.preventDefault(),(0,W.zB)(window.location.href)}),[]);return(0,o.jsx)(b.J,{isOpen:e,onOpen:c,renderInline:!0,role:n?"alert":"tooltip",tailPosition:s?"end":void 0,target:r,toggle:t,variant:n?"warning":"primary",zIndex:1100,children:n?(0,o.jsx)("span",{"data-test":"save-offer-popover-error",ref:l,tabIndex:-1,children:a}):(0,o.jsx)(U.r,{className:"h-margin-a-tiny",color:"onDark","data-test":"save-offer-popover-sign-in-link",onClick:f,ref:l,underline:"always",children:"Sign in to save this offer"})})};H.displayName="SaveCircleOfferPopover";const Q=l.ZP.svg.withConfig({displayName:"AnimatedIcon__AnimatedSvg",componentId:"sc-x6qm3h-0"})([".plus{clip-path:",";transition:clip-path 300ms;transition-delay:100ms;",";}.checkmark{clip-path:inset(0 100% 0 0);transition:clip-path 100ms;transition-delay:0;","}@media (prefers-reduced-motion){.plus,.checkmark{transition:none;transition-delay:0;}}"],"polygon(0% 0%, 0% 100%, 50% 100%, 50% 50%, 50% 50%, 50% 50%, 50% 50%, 50% 100%, 100% 100%, 100% 0%)",(e=>e.isOfferAdded?"\n    clip-path: polygon(0% 0%, 0% 100%, 0 100%, 0 0, 100% 0, 100% 100%, 0 100%, 0 100%, 100% 100%, 100% 0%);\n    transition: clip-path 100ms;\n    transition-delay: 0;\n    ":""),(e=>e.isOfferAdded?"\n    clip-path: inset(0);\n    transition: clip-path 300ms;\n    transition-delay: 100ms;\n    ":"")),q=({isOfferAdded:e=!1,size:r=24})=>(0,o.jsxs)(Q,{focusable:"false",height:r,isOfferAdded:e,role:"presentation",viewBox:"0 0 24 24",width:r,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",children:[(0,o.jsx)("path",{className:"plus",d:"M12.75 3.25v8h8v1.5h-8v8h-1.5v-8h-8v-1.5h8v-8z",fill:c.colors.palette.red.default}),(0,o.jsx)("path",{className:"checkmark",d:"M8.923 16.443l-4.395-4.364-1.056 1.064 5.451 5.414L20.528 7.032l-1.056-1.064z",fill:c.colors.palette.green.light})]});q.displayName="AnimatedIcon";const X=l.ZP.a.withConfig({displayName:"styles__PreLineLink",componentId:"sc-122dvwh-0"})(["white-space:pre-line;"]);function ee(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function re(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ee(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ee(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var te;!function(e){e.ADDED_OFFER="ADDED_OFFER",e.ADD_OFFER_ERROR="ADD_OFFER_ERROR",e.REMOVED_OFFER="REMOVED_OFFER",e.REMOVE_OFFER_ERROR="REMOVE_OFFER_ERROR"}(te||(te={}));const ne=e=>e===T?"Failed to add offer. Try refreshing the page.":e===$?"Failed to remove offer. Try refreshing the page.":void 0,oe=({buttonSize:e,confirmedText:r,initialText:t,isOfferAddedDefault:n,offerId:l,offerAriaLabel:c,onAddOffer:f,onRemoveOffer:d,variation:u,trackingDetails:p,shouldTrack:O=!0})=>{var v;const[g,m]=(0,Z.H)(),{openJoinCircleModal:h,isGuestLoggedIn:E,isCircleEnrolled:I}=(()=>{const{openJoinCircleModal:e,closeJoinCircleModal:r,isCircleEnrolled:t,isGuestLoggedIn:n}=(0,i.useContext)(J.j);return{closeJoinCircleModal:r,openJoinCircleModal:e,isCircleEnrolled:t,isGuestLoggedIn:n}})(),w=(0,F.l)(),{pricingStoreId:A}=(0,a.K)(),{screenSmMax:P}=(0,s.l)(),{0:D,1:S}=(0,i.useState)(void 0),{0:k,1:L}=(0,i.useState)(!1),{0:x,1:G}=(0,i.useState)(!1),U=(e=>{const{trackEvent:r}=(0,Y.rS)(),t=(0,B.Kk)(),n=(0,z.ew)(t),o=null===e||void 0===e?void 0:e.strategyId;return i=>{const{offerId:a,action:s,offerAriaLabel:l}=null!==i&&void 0!==i?i:{};if(!a)return;let c,f;s===te.ADDED_OFFER?c=!0:s===te.ADD_OFFER_ERROR&&(c=!1),s===te.REMOVED_OFFER?f=!0:s===te.REMOVE_OFFER_ERROR&&(f=!1),r({appState:{url:t,cmsPageId:n},guest:{eventType:"click"},offerInfo:K(K(K({},c?{addOffer:c}:{}),f?{removeOffer:f}:{}),{},{offers:[{offerId:a,offerSelected:void 0!==c||void 0!==f,offerType:"cartwheel"}]}),promotionInfo:{promos:[{id:a,omtOfferId:a,added:c,removed:f,longTagSpecialOffer:l}]}}),o&&(0,Y.OK)({recClick:{type:"promo",offerId:a,position:null===e||void 0===e?void 0:e.position,strategyId:null===e||void 0===e?void 0:e.strategyId,strategyName:null===e||void 0===e?void 0:e.strategyName}})}})(p),W=n?$:C,{0:Q,1:ee}=(0,i.useState)(W),{0:oe,1:ie}=(0,i.useState)(!1),ae=l?null===g||void 0===g||null===(v=g[l])||void 0===v?void 0:v.added:void 0,{0:se,1:le}=(0,i.useState)("");(0,i.useEffect)((()=>{if(!0===ae){if(Q===$)return;return ee($)}if(!1===ae){if(Q===T)return;return ee(T)}ee(W)}),[ae,W,Q,l]);const ce=(0,i.useCallback)((e=>{const r={action:e,offerId:l,offerAriaLabel:c};null===f||void 0===f||f(r),O&&U(r)}),[l,c,f,O,U]),fe=(0,i.useCallback)((e=>{const r={action:e,offerId:l,offerAriaLabel:c};null===d||void 0===d||d(r),O&&U(r)}),[l,c,d,O,U]),de=(0,i.useCallback)((e=>{var r,t,n;409===(null===e||void 0===e?void 0:e.status)&&S(null===e||void 0===e||null===(r=e.response)||void 0===r||null===(t=r.data)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.NOT_ENOUGH_SLOTS);ie(!0),ce(te.ADD_OFFER_ERROR),ee(T)}),[ce]),ue=(0,i.useCallback)((()=>{oe&&ie(!1),ce(te.ADDED_OFFER),ee($),le("Offer saved"),m&&m({type:V.N.ADD_OFFER,value:{offerId:l}})}),[ce,oe,l,m]),[pe]=j({onError:de,onSuccess:ue}),Oe=(0,i.useCallback)((()=>{var e;G(!1),null===(e=Ee.current)||void 0===e||e.focus()}),[]),ve=(0,i.useCallback)((()=>{oe&&ie(!1),fe(te.REMOVED_OFFER),ee(T),le("Offer removed"),m&&m({type:V.N.REMOVE_OFFER,value:{offerId:l}})}),[fe,oe,l,m]),ge=(0,i.useCallback)((()=>{ie(!0),fe(te.REMOVE_OFFER_ERROR),ee($)}),[fe]),[me]=N({onError:ge,onSuccess:ve});(0,i.useEffect)((()=>{oe&&L((e=>e||!0))}),[oe]);const he=(0,i.useCallback)((async()=>{if(!oe){if(!E)return L(!0);if(E&&!I)return h();switch(ee(M),Q){case C:case T:if(l)return G(!0),pe({offerId:l,LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:w,storeId:A});break;case $:if(l)return me({offerId:l,LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:w})}}}),[pe,oe,me,I,E,l,Q,h,L,A,w]),Ee=(0,i.useRef)(null),_e=(0,i.useCallback)((()=>{L((e=>(e&&(S(void 0),ie(!1)),!e)))}),[]),ye=P?"sm":"lg",be="secondary"===u?y:_,Re="iconOnly"===u,Fe=(0,i.useRef)(null),Ie=(0,i.useCallback)((()=>{var e;null===(e=Fe.current)||void 0===e||e.focus()}),[]);return l?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(H,{errorMessage:null!==D&&void 0!==D?D:ne(Q),isErrorState:oe,isIconOnly:Re,isPopoverOpen:k,offerButtonRef:Ee,setIsPopoverOpenToggle:_e}),"391328"===l&&(0,o.jsx)(b.J,{isDismissible:!0,isOpen:x,onDismiss:Oe,onOpen:Ie,renderInline:!0,role:"tooltip",target:Ee,variant:"primary",children:(0,o.jsx)(X,{ref:Fe,tabIndex:-1,children:"Add your Shipt membership\nand check out to redeem."})}),Re?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"h-sr-only",role:"alert",children:se}),(0,o.jsx)(R.H,{"aria-label":Q===$?`Remove offer: ${c}`:`Save offer: ${c}`,className:"h-padding-a-tiny",onClick:he,ref:Ee,renderIcon:(0,o.jsx)(q,{isOfferAdded:Q===$,size:36}),type:"button"})]}):(0,o.jsx)(be,re(re({"aria-label":Q===$?`Remove offer: ${c}`:`Save offer: ${c}`,"data-test":"save-circle-offer-button",isConfirmed:Q===$,isFullWidth:!0,isPending:Q===M,onClick:he,ref:Ee,size:null!==e&&void 0!==e?e:ye},r?{confirmedText:r}:{}),t?{initialText:t}:{}))]}):null};oe.displayName="SaveCircleOfferButton"},28235:function(e,r,t){t.d(r,{b:function(){return l}});var n=t(67294),o=t(18907),i=t(5068);const a=(0,o.N)('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" focusable="false" role="presentation"><path d="M12.75 3.25v8h8v1.5h-8v8h-1.5v-8h-8v-1.5h8v-8z"/></svg>'),s={width:"24",height:"24",id:"NavigationPlusFill",monochrome:!0,grayscale:!1,fullColor:!1,fills:["#333333"],nameComponents:{name:"PlusFill",category:"Navigation",variant:null}},l=e=>{var r;const t=n.useId(),o=a({idPrefix:null!==(r=e.id)&&void 0!==r?r:`nds-Icon${t}`});return n.createElement(i.J,Object.assign({},e,{svgData:o,svgMetadata:s}))};l.metadata=s,l.displayName="IconNavigationPlusFill"}}]);