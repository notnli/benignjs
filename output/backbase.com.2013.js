b$.module("b$.view.bdom",function(){var b=b$.bdom.getNamespace("http://backbase.com/2012/view").getClass("DesignElement");var a=b.extend(null,{namespaceURI:"http://backbase.com/2013/view",localName:"ViewElement",getHTMLNode:function(){return this.getDisplay()}})});b$.module("b$.portal.view.bdom.default",function(){var c=function(){return this}();var d=b$.bdom.Namespace;var o=b$.view.bdom.Component;var v=b$.bdom.getNamespace("http://backbase.com/2013/view").getClass("ViewElement");var s=b$.view.perspective.Perspective;var p=b$.view.perspective.PerspectiveType;var i=b$.view.perspective.PerspectiveParameters;var l=b$._private.template.SimpleURITemplate;var b=b$._private.htmlAPI;var u=b$._private.xml;var h=d.extend(function(x){d.call(this,x)},{});var r=new h("http://backbase.com/2013/portalView");this.NS=r;var q=function(y,B,A,x){var z=this;b$.portal.portalServer.loadItemHTML(y.originalItem,function(G,F){var E=G.substring(0,G.indexOf("<body>"))+"</html>";var C=G.substring(G.indexOf("<body>")+6,G.indexOf('<script type="text/backbase-xml'));var H="";if(G.indexOf('<script type="text/backbase-xml">')!==-1){H=G.substring(G.indexOf('<script type="text/backbase-xml">')+33,G.indexOf("<\/script>",G.indexOf('<script type="text/backbase-xml">')+33))}var D=u.parse(E);b$.portal._private.definition.getResourcesFromDefinition(D,"",function(){var M=b.createElementFromString(C);var K=y.ownerDocument;y.destroy();var J=u.parse(H);var L=b$.portal.importPortalModel(J,K,null,M);if(A){A(L,F)}var I=M.viewController;if(I.ownerDocument.documentElement.designMode){I.enableDesignMode()}},function(){var K=b.createElementFromString("<span>This part of the page can't be rendered </span>");K.viewController=B.viewController;B.appendChild(K);var I=u.parse(H);var J=b$.portal.portalServer.itemXMLDOC2JSON(I);y.setItem(J);if(A){A()}})},x,true)};var g={ADMIN:0,CREATOR:-1,COLLABORATOR:-2,CONTRIBUTOR:-3,CONSUMER:-4};var f;var n=v.extend(function(){v.apply(this,arguments);if(this.ownerDocument.defaultDragHandlers){this.addHandlers(this.ownerDocument.defaultDragHandlers)}},{localName:"portalViewElement",namespaceURI:"http://backbase.com/2013/portalView",insertDisplayChild:function(G,C){if(!(G.model&&G.model._ssr)&&G.injectDisplaySelf(G,C)&&G.htmlNode){if(!G.getPreference){var F=this.getDisplay("area")||this.getDisplay();F.appendChild(G.htmlNode);return}var E=this.getDisplay("area",true)||this.getDisplay();var D=parseInt(G.getPreference("area"),10)||0;var y=E[D]?D:E.length-1;var B=parseInt(G.getPreference("order"),10)||0;var A;if(E[y].childNodes.length){for(var z=E[y].childNodes.length-1;z>=0;z--){if(E[y].childNodes[z]!==G.htmlNode&&E[y].childNodes[z].viewController){var x=parseInt(E[y].childNodes[z].viewController.getPreference("order"),10);if(x>B){A=E[y].childNodes[z].viewController}}}}if(C&&C.htmlNode){C.htmlNode.parentNode.insertBefore(G.htmlNode,C.htmlNode)}else{if(A){E[y].insertBefore(G.htmlNode,A.htmlNode)}else{E[y].appendChild(G.htmlNode)}}}},dragIsTarget:function(){return this.isPossibleDragTarget},refreshHTML:function(B,x){var A=this.model.parentNode;var y=this.ownerDocument;q(this.model,null,function(F,C){var E,D;A.appendChild(F);E=y.all[b$.portal.portalReflector.getID(A)];D=y.all[b$.portal.portalReflector.getID(F)];E.insertDisplayChild(D);if(B){B(D,C)}});return;var z=this;b$.portal.portalServer.loadItemHTML(this.model.getJSON(),function(F){var E=F.substring(0,F.indexOf("<body>"))+"</html>";var C=F.substring(F.indexOf("<body>")+6,F.indexOf('<script type="text/backbase-xml"'));var G="";if(F.indexOf('<script type="text/backbase-xml">')!==-1){G=F.substring(F.indexOf('<script type="text/backbase-xml">')+33,F.indexOf("<\/script>",F.indexOf('<script type="text/backbase-xml">')+33))}var D=u.parse(E);b$.portal._private.definition.getResourcesFromDefinition(D,"",function(){if(z.htmlNode!=null){z.htmlNode.innerHTML=""}var K=b.createElementFromString(C);if(!K){K=b.createElementFromString("<span>"+C+"</span>")}K.viewController=z.htmlNode.parentNode.viewController;z.htmlNode.parentNode.insertBefore(K,z.htmlNode);var I=z.model.parentNode;z.model.destroy();var H=u.parse(G);var J=b$.portal.portalServer.itemXMLDOC2JSON(H);b$.portal._buildModelFromJSON(I.ownerDocument,J,I);if(B){B()}})},x,true)},loadChildren:function(C,B){var z=[];if(!this.model._children){return}if(C){z.push(C)}else{z=this.model._children}var y=this;for(var x=z.length-1;x>=0;x--){if(b$.portal.portalModel.getElementById(z[x].name)){break}var A=function(F,I){var H=F.substring(0,F.indexOf("<body>"))+"</html>";var D=F.substring(F.indexOf("<body>")+6,F.indexOf('<script type="text/backbase-xml'));var J="";if(F.indexOf('<script type="text/backbase-xml">')!==-1){J=F.substring(F.indexOf('<script type="text/backbase-xml">')+33,F.indexOf("<\/script>",F.indexOf('<script type="text/backbase-xml">')+33))}var E=function(){var R=b$._private.htmlAPI.createElementFromString(D);var S=b$._private.xml.parse(J);var P=b$._private.xml.textContent(b$.ua.querySelector(S,"property[name=area] value"))||0;var L=b$._private.xml.textContent(b$.ua.querySelector(S,"property[name=order] value"))||0;var N=y.htmlAreas[P];var O=true;var Q=null;for(var M=0;M<N.childNodes.length;M++){if(N.childNodes[M].getAttribute("data-pid")==R.getAttribute("data-pid")){O=false;break}else{if(N.childNodes[M].viewController){if(L<N.childNodes[M].viewController.getPreference("order")){Q=N.childNodes[M]}}else{Q=N.childNodes[M]}}}if(O){if(Q){N.insertBefore(R,Q)}else{N.appendChild(R)}}var K=b$.portal.importPortalModel(S,b$.portal.portalModel,y.model,R);if(B){B(R.viewController)}};var G=b$._private.xml.parse(H);b$.portal._private.definition.getResourcesFromDefinition(G,"",E,null,true)};b$.portal.portalServer.loadItemHTML(z[x],A,null,true,-1,null)}},getPreference:function(x,z){var y=this.model?this.model.getPreference(x):this.getAttribute(x);return z?decodeURIComponent(y):y},setPreference:function(x,y){return this.model.setPreference(x,y)},isPreference:function(x){var y=this.getPreference(x);return y!=null&&y!=""},setHightlightDropArea:function(z,B){var A=this.getTarget(z,B);this.removeHightlightDropAreas();A.classList.add("bp-drop-zone-highlight");f=A},removeHightlightDropAreas:function(z,B){var A=this.getTarget(z,B);if(f){f.classList.remove("bp-drop-zone-highlight")}A.classList.remove("bp-drop-zone-highlight")},getHTMLareas:function(){var x=this.getDisplay("area",true);if(!x.length){x=b.findCaptureClass("bp-area",this.htmlNode)}return x},getTargetAreaId:function(H,G){var A=this.getHTMLareas();var D=null;var F=null;var z=Infinity;for(var C=0;C<A.length;C++){var B=b.getBoxObject(A[C],"border");if(k(H,G,B.x,B.y,B.w,B.h)){D=C;break}var E=Math.abs((B.x+B.w/2)-H)+Math.abs((B.y+B.h/2)-G);if(E<z){z=E;F=C}}if(D==null){if(this.tmp_lastTargetAreaId){D=this.tmp_lastTargetAreaId}else{if(F==null){D=0}else{D=F}}}this.tmp_lastTargetAreaId=D;return D},getTarget:function(z,C){var A=this.getHTMLareas();var B=this.getTargetAreaId(z,C);return A[B]},getAreaPreference:function(){if(this.area===undefined){if(this.model){var x=parseInt(this.model.getPreference("area"),10);if(isNaN(x)){x=0}}else{var x=parseInt(this.getAttribute("area"),10);if(isNaN(x)){x=0}}return x}else{return this.area}},getOrderPreference:function(){if(this.order===undefined){if(this.model){var x=parseInt(this.model.getPreference("order"),10);if(isNaN(x)){x=0}}else{var x=parseInt(this.getAttribute("order"),10);if(isNaN(x)){x=0}}return x}else{return this.order}},m_dragEnter:function(C,B){var A=g[this.model.securityProfile];if(A<g.CONTRIBUTOR){return false}var z=C.clientX;var D=C.clientY;this.appendChild(this.ownerDocument.dragIndicator);this.setHightlightDropArea(z,D)},m_dragOut:function(F,B){var A=g[this.model.securityProfile];if(A<g.CONTRIBUTOR){return false}var z=F.clientX;var G=F.clientY;var D=this.ownerDocument.dragIndicator.getDisplay();if(D){D.parentNode.removeChild(D);this.removeChild(this.ownerDocument.dragIndicator)}delete this.tmp_lastTargetAreaId;var E=this.childNodes;for(var C=0;C<E.length;C++){E[C].tmp_order=E[C].getOrderPreference();delete E[C].area;delete E[C].order}this.reflow();this.removeHightlightDropAreas(z,G)},m_dragMove:function(M,K){var C=g[this.model.securityProfile];if(C<g.CONTRIBUTOR){return false}var z=document.body.scrollTop?document.body.scrollTop:document.body.parentNode.scrollTop?document.body.parentNode.scrollTop:0;var L=document.body.scrollLeft?document.body.scrollLeft:document.body.parentNode.scrollLeft?document.body.parentNode.scrollLeft:0;var F=M.clientX+L;var E=M.clientY+z;var N=null;var Q=K.dataTransfer.getData("x-bb-nodelist");if(Q&&Q[0]){N=Q[0]}var I=this.getHTMLareas();var B=this.getTargetAreaId(F,E);var T=this.getTarget(F,E);K.__tmpArea=B;K.__tmpOrder=0;this.ownerDocument.dragIndicator.area=B;var D=this.getAreaOrderedChildren();var R=D[B];var J=false;if(R){for(var O=0;O<R.length;O++){if(R[O]!=this.ownerDocument.dragIndicator){if(!J){var H=b.getBoxObject(R[O].htmlNode,"border");if((this.layout.dir.direction=="horizontal"&&F<H.x+(H.w/2))||(this.layout.dir.direction=="vertical"&&E<H.y+(H.h/2))){J=true;this.ownerDocument.dragIndicator.order=K.__tmpOrder;var G=this.ownerDocument.dragIndicator.getDisplay();var P=R[O].getDisplay();P.parentNode.insertBefore(G,P);K.__tmpOrder++;if(N==R[O].model){G.display="none"}else{G.display="block"}}}R[O].order=K.__tmpOrder;K.__tmpOrder++}}}if(!J){this.ownerDocument.dragIndicator.order=K.__tmpOrder;if(!I[B]){console.log("____________________________________________",this)}I[B].appendChild(this.ownerDocument.dragIndicator.getDisplay())}var A=this.ownerDocument.dragIndicator;var N;var S=K.dataTransfer.getData("x-bb-nodelist");if(S){N=S[0]}A.getDisplay().style.display="block";if(!K.dragOptions.htmlNode.catalogItemJson){if(N.parentNode==A.parentNode){if(N.getAreaPreference()==A.area){if(N.order+1==A.order||N.order-1==A.order){A.getDisplay().style.display="none"}}}}this.reflow();return},m_dragDrop:function(x,A,G){var D=this;if(B("CONTRIBUTOR")){return false}if(!G.isCatalog&&D!==G.parentNode){G.parentNode.childNodes.forEach(function(J){if(J!==G){J.model.setPreference("order",J.tmp_order);J.model.save()}})}D.childNodes.forEach(function(K){if(K!==G&&K.tmp_order){var J=F("order",parseFloat(K.tmp_order),"double");K.model.setPreferenceNode(J);K.model.save()}});if(G.isCatalog&&A.dragOptions.htmlNode&&A.dragOptions.htmlNode.catalogItemJson){var z=A.dragOptions.htmlNode.catalogItemJson;var I=z.extendedItemName;var C=b$.portal.portalView.getElementsByTagName("page").pop();var H=E(z);H.parentItemName=D.model.name;y(H,"area",D.ownerDocument.dragIndicator.area+"","string");y(H,"order",D.ownerDocument.dragIndicator.order+"","double");if(C.pageType==="master"){H.extendedItemName=I}H.save(function(){if(!H.contextItemName){H.isWidgetRenderingTriggeredByDragAndDropFromTargeting=true;D.model.appendChild(H)}else{q(H,D.htmlNode,function(L){L.isWidgetRenderingTriggeredByDragAndDropFromTargeting=true;var K,J;D.model.appendChild(L);K=D.ownerDocument.all[b$.portal.portalReflector.getID(D.model)];J=D.ownerDocument.all[b$.portal.portalReflector.getID(L)];K.insertDisplayChild(J)})}},function(){})}else{G.model.setPreference("area",D.ownerDocument.dragIndicator.area.toString());y(G.model,"order",D.ownerDocument.dragIndicator.order+"","double");G.model.parentItemName=D.model.name;D.model.appendChild(G.model);G.model.save()}if(G.parentNode){G.parentNode.reflow()}D.reflow();function F(J,M,L){var K=D.model.ownerDocument.createPreference(J,L);K.value=M;return K}function y(J,K,N,M){if(J.getPreferenceNode(K)){J.setPreference(K,N)}else{var L=F(K,N,M);J.setPreferenceNode(L)}}function B(J){return g[D.model.securityProfile]<g[J]}function E(J){var K=D.model.createExtendedElementFromJSON(J);if(J.children){J.children.forEach(function(L){K.appendChild(extend(L),true)})}return K}},createPerspective:function(x,y){return new s(new l("/","page"),x,y)},getCurrentPerspective:function(){return this.perspective},setCurrentPerspective:function(x){this.perspective=x},addHandlers:function(x){for(var y in x){if(x.hasOwnProperty(y)){this.addEventListener(y,x[y])}}},removeHandlers:function(x){for(var y in x){if(x.hasOwnProperty(y)){this.removeEventListener(y,x[y])}}},processConfig:function(){try{var y=this.getPreference("config");if(y){var x=JSON.parse(y);b$.mixin(this,x)}}catch(z){console.log("Error parsing config: "+z)}},persistConfig:function(){try{var z=this.getPreference("config");var x=JSON.parse(z);for(var y in x){if(x[y]!==this[y]){x[y]=this[y]}}z=JSON.stringify(x);this.setPreference("config",z);this.model.save()}catch(A){console.log("Error persisting config: "+A)}},addToConfig:function(x,B){try{var z=this.getPreference("config");var y=JSON.parse(z);y[x]=B;z=JSON.stringify(y);this.setPreference("config",z);this.model.save()}catch(A){console.log("Error adding preference to config: "+A)}},removeFromConfig:function(x){try{var z=this.getPreference("config");var y=JSON.parse(z);delete y[x];z=JSON.stringify(y);this.setPreference("config",z);this.model.save()}catch(A){console.log("Error removing preference from config: "+A)}}});this.portalViewElement=n;function j(y,x){y=parseInt(y.getOrderPreference())||0;x=parseInt(x.getOrderPreference())||0;return y-x}function k(C,A,z,E,B,D){if(C>=z&&C<=z+B&&A>=E&&A<=E+D){return true}return false}var t=b$.view.bdom.layout;var w=n.extend(function(x,y){n.apply(this,arguments);this.layout=new t.NoLayout(this)},{localName:"application",renderDisplay:function(){return this.htmlNode}});var a=n.extend(function(x,y){n.apply(this,arguments);this.perspective=this.createPerspective(new p("Dashboard"),new i());this.addEventListener("PerspectiveModified",function(z){this.setCurrentPerspective(this.createPerspective(new p(z.newValue),new i()))},false,this)},{localName:"portal",injectDisplaySelf:function(){},insertDisplayChild:function(x){if(!(x.model&&x.model._ssr)){b$._private.ssrRootElement.appendChild(x.htmlNode)}},attachHTMLChildren:function(){var x=this.childNodes;for(var y=0;y<x.length;y++){var z=x[y].getHTMLNode();if(!z.parentNode||z.parentNode.nodeType!=1){document.body.appendChild(z)}}},showDesignTools:function(){},hideDesignTools:function(){}},{template:function(x){return'<div class="'+this.cls+" "+this.cls+'--area"></div>'}});var m=n.extend(function(x,y){n.apply(this,arguments);this.layout=new t.NoLayout(this);this.isPossibleDragTarget=true},{localName:"page",pageType:undefined,createDisplay:function(){if(!this.htmlNode){this.htmlNode=this.renderDisplay(this.getDisplayModel())}if(!this.htmlAreas){this.htmlAreas=this.getDisplay("area",true)}this.htmlNode.viewController=this;if(!this.htmlAreas||this.htmlAreas.length<=0){this.htmlAreas=[];var x=b.findCaptureClass("bp-area",this.htmlNode);if(x[0]){b.addClass(x[0],"--area");this.htmlAreas.push(x[0])}}if(this.model.manageable){this.pageType="master"}else{if(this.model.extendedItemName==""){this.pageType="normal"}else{this.pageType="inherited"}}},readyHTML:function(){n.prototype.readyHTML.call(this)},showDesignTools:function(){},hideDesignTools:function(){}},{template:function(x){return'<div class="'+this.cls+'"><div class="'+this.cls+'--area"></div></div>'}});var e=n.extend(function(x,y){n.apply(this,arguments);this.layout=new t.AutoLayout(this);this.isPossibleDragTarget=false;this.flex=1;this.area=0;this.order=0},{localName:"dragIndicator",setHTMLWidthHeight:function(y,x){var z=this.htmlNode;b.setWidthHeightPB(z,y,x);b.setWidthHeightPB(z.firstChild,y-b.getPadding(z)-b.getBorder(z),x-b.getPadding(z,"tb")-b.getBorder(z,"tb"))},renderDisplay:function(x){if(!x){x=document.createElement("div");x.className="bp-drag-indicator";x.innerHTML='<div class="bp-drag-indicator-in"><span class="bp-drag-text"></span></div>'}return x},getAreaPreference:function(){return this.area},getOrderPreference:function(){return this.order},setAreaPreference:function(x){this.area=x},setOrderPreference:function(x){this.order=x}})});b$.module("b$.portal.view.bdom.container",function(){var b=b$.bdom.getNamespace("http://backbase.com/2013/portalView").getClass("portalViewElement");var c=b$.view.bdom.layout;var a=b.extend(function(d,e){b.apply(this,arguments);this.layout=new c.NoLayout(this)},{localName:"container",createDisplay:function(){if(!this.htmlNode){this.htmlNode=this.renderDisplay(this.getDisplayModel())}if(!this.htmlAreas){this.htmlAreas=this.getDisplay("area",true)}this.htmlNode.viewController=this},constrainProportions:function(g,d){var j=0,f,e,h;h=g.concat(new Array(d)).splice(0,d);for(e=0;e<d;e++){h[e]=Math.round((h[e]||0)*100)/100;j+=h[e]}if(j===0){for(e=0;e<d;e++){h[e]=Math.round(100/d*100)/100}}else{if(j!==100){f=j/100;for(e=0;e<d;e++){h[e]=h[e]/f}}}return h}},{template:function(){return'<div class="bp-container"><div class="bp-area"></div></div>'}})});b$.module("b$.portal.view.bdom.widget",function(){var i=function(){return this}();var d=b$.view.perspective.PerspectiveType;var a=b$.view.perspective.PerspectiveParameters;var e=b$.view.perspective.Perspective;var h=b$._private.template.SimpleURITemplate;var f=b$._private.htmlAPI;var b=b$._private.simpleResponseCache_getData;var c=b$.bdom.getNamespace("http://backbase.com/2013/portalView");var j=c.getClass("portalViewElement");var g=j.extend(function(k,l){j.apply(this,arguments);this.id="none";this.flex=1},{localName:"widget",createDisplay:function(){this.htmlNode=this.renderDisplay();if(this.htmlNode){this.htmlNode.viewController=this}return this.htmlNode},renderDisplay:function(){var k=document;if(!this.htmlNode){this.htmlNode=b$.portal.view.loadChrome(this,k)}this.bindChromeHandlers();this.htmlAreas=[];this.htmlAreas[0]=f.cssSelector(".bp-widget-body",this.htmlNode)[0];return this.htmlNode},setHTMLWidthHeight:function(l,k){var m=this.htmlNode;if(l!==undefined){f.setWidth(m,l)}if(k!==undefined){f.setHeight(m,k);f.setHeightPB(this.htmlAreas[0],k-this.htmlHead.offsetHeight-this.htmlFoot.offsetHeight)}},DOMReady:function(){var k=this;if(this.ownerDocument.defaultDragHandlers){this.addHandlers(this.ownerDocument.defaultDragHandlers)}this.id=this.model.name;if(k.model){k.model.addEventListener("PrefModified",function(n){if(n.target===k.model){var l=n.relatedNode;if(l){var m=this.ownerDocument.createEvent("UIEvent");m.initUIEvent("change",true,false,window,null);l.dispatchEvent(m,false)}}},false,k);k.model.addEventListener("PrefFallback",function(l){if(l.target===k.model){k.refreshHTML()}},false,k);this.addEventListener("PerspectiveModified",function(m){if(m.target.model===this.model&&(m.newValue==="Maximized"||m.newValue==="Widget")){var l=this.ownerDocument.createEvent("MutationEvent");l.initMutationEvent(m.newValue==="Maximized"?"maximize":"restore",true,false,this,null,null,null,null);this.model.dispatchEvent(l,true)}},false,this)}},bindChromeHandlers:function(){var k=this;f.bindEvent(this.htmlNode,"click",function(o){var q=o.target;var p;var m=f.cssSelector(".bp-widget-pref",this)[0];while(true){p=q.getAttribute("data-action");if(p){switch(p){case"widget-preferences":k.dispatchCustomEvent("preferences-form",true,true,{context:k});break;case"widget-maximize":k.setPerspective("Maximized");break;break;case"widget-restore":k.setPerspective("Widget");q.setAttribute("data-action","widget-minimize");break;case"widget-minimize":k.setPerspective("Minimized");q.setAttribute("data-action","widget-restore");break;case"widget-refresh":k.refreshHTML();break;case"widget-close":k.model.destroyAndSave();break;case"pref-ok":var n=f.cssSelector("form",m)[0];for(var l=0;l<n.elements.length;l++){var r=n.elements[l];if(r.type==="text"){if(r.value!==k.model.getPreference(r.name)){console.log(r.name,r.value);k.model.setPreference(r.name,r.value)}}else{if(r.type==="checkbox"){if(r.checked!==k.model.getPreference(r.name)){console.log(r.name,r.checked);k.model.setPreference(r.name,r.checked)}}}}k.model.save();m.style.display="none";break;case"pref-cancel":m.style.display="none";break}}if(q==o.currentTarget){break}q=q.parentNode;if(!q){break}}})},setTitle:function(k){this.model.setPreference("title",k);this.model.save()},getDefinition:function(){return{}},setPerspective:function(l){if(l!==this.perspective.getType().getName()){this.perspective=new e(new h(this.getDefinition().sUrl||this.sSrc,"page"),new d(l),new a());var k=this.ownerDocument.createEvent("MutationEvent");k.initMutationEvent("PerspectiveModified",true,false,this,this.perspective,l,null,null);this.dispatchEvent(k)}},getContextVariableValue:function(l){var k=this.perspective.getParameters().getByName(l);return k&&k.getValue()||""}});this.Widget=g;defaultChrome='<div class="bp-widget Xbp-ui-dragRoot Xbp-ui-dragGrip"><div class="bp-widget-head"></div><div class="bp-widget-pref"></div><div class="bp-widget-body"></div><div class="bp-widget-foot"></div></div>';var f=b$._private.htmlAPI;b$.portal.view.loadChrome=function(r,q){var m={ADMIN:0,CREATOR:-1,COLLABORATOR:-2,CONTRIBUTOR:-3,CONSUMER:-4};var o=r.model;var k={};if(o){k=o.getJSON()}var s=r.getAttribute("widgetChrome");if(s){s=s.replace("$(contextRoot)",b$.portal.portalModel.serverURL);k.widgetTitle=r.getAttribute("title");var n=b(s)}else{var n=defaultChrome}if(o){var l=m[o.securityProfile];k.showEdit=l>=m.CONTRIBUTOR;k.showDelete=l>=m.CREATOR;k.enableDND=l>=m.CONTRIBUTOR;k.showMaximize=true}var p=f.createElementFromString(Mustache.to_html(n,k),q);return p}});b$.module("b$.portal.view.bdom.widget.backbase",function(){var d=b$.bdom.getNamespace("http://backbase.com/2013/portalView");var h=d.getClass("widget");var e=b$.view.perspective.PerspectiveType;var a=b$.view.perspective.PerspectiveParameters;var f=b$.view.perspective.Perspective;var i=b$._private.template.SimpleURITemplate;var g=b$._private.htmlAPI;var b=new b$._private.AsyncComponentBuilder();var c=h.extend(null,{localName:"backbaseWidget",createDisplay:function(){this.htmlNode=this.renderDisplay();if(this.htmlNode){this.htmlNode.viewController=this}return this.htmlNode},renderDisplay:function(){var j=document;if(!this.htmlNode){this.htmlNode=b$.portal.view.loadChrome(this,j)}this.bindChromeHandlers();this.htmlHead=g.cssSelector(".bp-widget-head",this.htmlNode)[0];this.htmlFoot=g.cssSelector(".bp-widget-foot",this.htmlNode)[0];this.htmlAreas=[];this.htmlAreas[0]=g.cssSelector(".bp-widget-body",this.htmlNode)[0];this.body=this.htmlAreas[0];this.isClientSideRenderedOnly=!(this.body&&this.body.firstChild);if(this.model.isWidgetRenderingTriggeredByDragAndDropFromTargeting||this.isClientSideRenderedOnly){this.buildWidgetByDefinition()}else{this.buildWidget()}return this.htmlNode},readyHTML:function(){h.prototype.readyHTML.call(this)},updateByDefinition:function(j){b.buildWidget(this.myDefinition.sUrl,true,this,function(n){if(this.processed){if(j){j()}return}this.myDefinition=n;this.includes=n.getIncludesFromDefinition(this);n.getPreferencesFromDefinition(this);if(this.isClientSideRenderedOnly){this.body.appendChild(n.getHTMLBodyFromDefinition())}var m=this.body;var o=g.cssSelector(".bp-g-include",m);if(o.length){for(var l=0;l<this.includes.length;l++){var k=this.includes[l];k.htmlNode=o[l];k.addEventListener("content",function(){this.htmlNode.innerHTML="";for(var p=0;p<this.content.length;p++){this.htmlNode.appendChild(this.content[p])}})}}this.processed=true;if(this.isClientSideRenderedOnly){this.refreshIncludes()}if(j){j()}}.bind(this))},buildWidget:function(m){var k=this.getAttribute("src");k=k.replace("$(contextRoot)",b$.portal.portalModel.serverURL);var j=this;var l=this.model.isWidgetRenderingTriggeredByDragAndDropFromTargeting||this.isClientSideRenderedOnly;b.buildWidget(k,l,j,function(p){var n=p.XListeners;this.myDefinition=p;if(this.model){for(var o in n){if(n.hasOwnProperty(o)){this.model.addEventListener(o,n[o],false,this)}}}this.perspective=new f(new i(k,"page"),new e("Dashboard"),new a());if(n.load){n.load.call(this)}if(m){m()}}.bind(this))},buildWidgetByDefinition:function(){this.buildWidget(this.updateByDefinition.bind(this))},refreshIncludes:function(){for(var k=0,j=this.includes.length;k<j;k++){this.includes[k].refresh()}},getOriginURI:function(){return this.getDefinition().sUrl},getDefinition:function(){return this.myDefinition},getBody:function(){return this},getIncludes:function(){return this.includes}})});