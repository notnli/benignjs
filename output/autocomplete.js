function Autocomplete(t,e,s,i,o){function n(t,e){for(;e!=t&&null!=t;)t=t.parentNode;return e==t}if(this.field=document.getElementById(t),this.wrapper=document.getElementById(e)||document.querySelector(e),this.full=s,this.hideImages=!!o,i)this.position=i;else{var h=e.match(/\d$/);this.position=h?h[0]:""}this.MAKER_ID=0,this.PHONE_ID=1,this.PHONE_NAME=2,this.SEARCH_STR=3,this.THUMB=4;const a=37,l=39,r=38,c=40,p=27,d=13;Autocomplete.prototype.listURL=AUTOCOMPLETE_LIST_URL,AUTOCOMPLETE_GLOBAL_DATA[this.globalDataName]={},this.div=$gsm.tag("div",{class:"autocomplete autocomplete-search autocomplete-small autocomplete-hide"},"",this.wrapper),this.parent=this.div,this.reviewsDiv=$gsm.tag("div",{class:"reviews-results float-left"},"",this.div),$gsm.tag("span",{class:"autocomplete-desc"},"Reviews",this.reviewsDiv),this.reviewsList=$gsm.tag("ul",{},"",this.reviewsDiv);var u=$gsm.tag("li",{class:"permanent"},"",this.reviewsList);this.reviewsMore=$gsm.tag("a",{class:"more-news-link more-news-link-small",href:"#"},"More review results",u),this.phonesDiv=$gsm.tag("div",{class:"phone-results"},"",this.div),this.phoneLabel=$gsm.tag("span",{class:"autocomplete-desc"},"Last visited",this.phonesDiv),this.phonesList=$gsm.tag("ul",{class:"autocomplete-last-searched"},"",this.phonesDiv),this.phonesMoreLi=$gsm.tag("li",{class:"permanent",style:"display: none;"},"",this.phonesList),this.phonesMore=$gsm.tag("a",{class:"more-news-link more-news-link-small",href:"#"},"More device results",this.phonesMoreLi),this.newsDiv=$gsm.tag("div",{class:"news-results float-left"},"",this.div),$gsm.tag("span",{class:"autocomplete-desc"},"News",this.newsDiv),this.newsList=$gsm.tag("ul",{},"",this.newsDiv);var m=$gsm.tag("li",{class:"permanent"},"",this.newsList);this.newsMore=$gsm.tag("a",{class:"more-news-link more-news-link-small",href:"#"},"More news results",m);var E=this.field.parentNode;this.position||(this.searchButtons=$gsm.tag("div",{class:"search-buttons"},"",E),this.goButton=$gsm.tag("a",{class:"go",href:"#"},"Go",this.searchButtons),this.advancedButton=$gsm.tag("a",{class:"advanced",href:"search.php3"},"Advanced",this.searchButtons)),i||(this.quickSearchButton=document.querySelector("#quick-search-button")),this.loadRecentPhones(),this.lastQuery="",$gsm.addEventListener(document,"click",function(t){n(t.target,this.parent)||this.hide()}.bind(this),!0),$gsm.addEventListener(document,"touchend",function(t){n(t.target,this.parent)||$gsm.hasClass(this.div,"autocomplete-hide")||this.hide()}.bind(this),!0),this.field.onclick=function(){this.list?this.searchPhones():this.loadList(),this.searchButtons&&(this.searchButtons.style.display="initial"),this.position||(this.quickSearchButton.style.display="none")}.bind(this),this.field.onkeyup=function(t){var e=this.field.value,s=this.div.querySelector(".autocomplete-selected");if(s&&$gsm.removeClass(s,"autocomplete-selected"),t.which!=c)if(t.which!=r){if(t.which==a||t.which==l){if(!this.full)return;if(!s)return;if(0==e.length)return void $gsm.addClass(s,"autocomplete-selected");for(var i=[this.reviewsList,this.phonesList,this.newsList],o=s.parentNode.parentNode,n=0;n<o.childElementCount&&o.children[n].firstChild!=s;n++);var h=t.which==a?-1:1,d=i.indexOf(o);do{d=(i.length+d+h)%i.length}while(0==i[d].childElementCount);return n=Math.min(n,i[d].childElementCount-1),void $gsm.addClass(i[d].children[n].firstChild,"autocomplete-selected")}t.which!=p?e.length>=1?(this.setList(this.phonesList,[]),this.searchPhones(),this.searchNewsAndReviews()):this.showRecentPhones():this.hide()}else if(s){var u=s.parentNode.previousSibling;u||(u=s.parentNode.parentNode.lastChild),$gsm.addClass(u.firstChild,"autocomplete-selected")}else $gsm.addClass(this.phonesMore,"autocomplete-selected");else if(s){var m=s.parentNode.nextSibling;m||(m=s.parentNode.parentNode.firstChild),$gsm.addClass(m.firstChild,"autocomplete-selected")}else this.phonesList.firstChild&&$gsm.addClass(this.phonesList.firstChild.firstChild,"autocomplete-selected")}.bind(this),this.field.onkeydown=function(t){const e=this.div.querySelector(".autocomplete-selected");if(t.which==d){if(e)return t.preventDefault(),t.stopPropagation(),"#"==e.getAttribute("href")?void e.onclick(t):void(window.location=e.href);if(this.ignoreEnterForSearch||this.value.length<AUTOCOMPLETE_NEWS_REVIEWS_MIN_LENGTH)return t.preventDefault(),void t.stopPropagation()}}.bind(this),this.phonesMore.onclick=function(t){t.preventDefault(),t.stopPropagation();for(var e=this.field.parentNode;"FORM"!=e.nodeName;)e=e.parentNode;e.submit()}.bind(this),this.goButton&&(this.goButton.onclick=this.phonesMore.onclick),this.newsMore.onclick=function(t){t.preventDefault(),t.stopPropagation(),window.location="news.php3?sSearch="+this.field.value}.bind(this),this.reviewsMore.onclick=function(t){t.preventDefault(),t.stopPropagation(),window.location="reviews.php3?sSearch="+this.field.value}.bind(this),document.activeElement!=this.field&&""===this.field.value||""===this.field.getAttribute("value")&&(this.loadList(),this.searchNewsAndReviews())}"undefined"==typeof AUTOCOMPLETE_MAX_LINES&&(AUTOCOMPLETE_MAX_LINES=5),"undefined"==typeof AUTOCOMPLETE_NEWS_REVIEWS_TIMEOUT&&(AUTOCOMPLETE_NEWS_REVIEWS_TIMEOUT=1e3),"undefined"==typeof AUTOCOMPLETE_NEWS_REVIEWS_MIN_LENGTH&&(AUTOCOMPLETE_NEWS_REVIEWS_MIN_LENGTH=2),"undefined"==typeof AUTOCOMPLETE_THUMB_URL&&(AUTOCOMPLETE_THUMB_URL=CDN2_BASE_URL+"vv/bigpic/"),"undefined"==typeof NEWS_REVIEWS_URL&&(NEWS_REVIEWS_URL="search-json.php3"),"undefined"==typeof AUTOCOMPLETE_RECENT_URL&&(AUTOCOMPLETE_RECENT_URL="history-json.php3");const AUTOCOMPLETE_GLOBAL_DATA={};Autocomplete.prototype.globalDataName="autocomplete",Autocomplete.prototype._copyInstanceValues=function(){this.list=AUTOCOMPLETE_GLOBAL_DATA[this.globalDataName].list,this.makers=AUTOCOMPLETE_GLOBAL_DATA[this.globalDataName].makers},Autocomplete.prototype._parseData=function(t){let e;try{e=JSON.parse(t)}catch(t){return}AUTOCOMPLETE_GLOBAL_DATA[this.globalDataName].makers=e[0],AUTOCOMPLETE_GLOBAL_DATA[this.globalDataName].list=e[1],this._copyInstanceValues()},Autocomplete.prototype.loadList=function(t){if(AUTOCOMPLETE_GLOBAL_DATA[this.globalDataName].loaded&&!this.list)return this._copyInstanceValues(),void("function"==typeof t&&t());AUTOCOMPLETE_GLOBAL_DATA[this.globalDataName].loading||(AUTOCOMPLETE_GLOBAL_DATA[this.globalDataName].loading=!0,AUTOCOMPLETE_GLOBAL_DATA[this.globalDataName].loaded=!1,$gsm.xhr("GET",this.listURL,function(e){this._parseData(e),AUTOCOMPLETE_GLOBAL_DATA[this.globalDataName].loading=!1,AUTOCOMPLETE_GLOBAL_DATA[this.globalDataName].loaded=!0,window.location.search.match(new RegExp("sSearch"+this.position+"="))||this.searchPhones(),"function"==typeof t&&t()}.bind(this),null,function(){},!0),""===this.field.value&&this.showRecentPhones())},Autocomplete.prototype.loadRecentPhones=function(){const t=localStorage.getItem("recentPhones");let e=[];try{t&&(e=JSON.parse(t))}catch(t){localStorage.removeItem("recentPhones")}if("undefined"!=typeof HISTORY_ITEM_URL){const t={href:HISTORY_ITEM_URL,src:HISTORY_ITEM_IMAGE,text:HISTORY_ITEM_NAME,id:HISTORY_ITEM_ID};let s=0;for(;s<e.length;)e[s].id==t.id||e[s].href==t.href?e.splice(s,1):s++;e.unshift(t),e.splice(AUTOCOMPLETE_MAX_LINES),localStorage.setItem("recentPhones",JSON.stringify(e))}AUTOCOMPLETE_GLOBAL_DATA[this.globalDataName].recent=e},Autocomplete.prototype.setList=function(t,e){for(var s=0;s<t.childElementCount;){var i=t.children[s];$gsm.hasClass(i,"permanent")?s++:t.removeChild(i)}for(s=e.length-1;s>=0;s--){var o=document.createElement("li");t.insertBefore(o,t.firstChild);var n=$gsm.tag("a",{href:e[s].href},"",o);$gsm.tag("img",{src:this.hideImages?"":e[s].src},"",n),$gsm.tag("span",{},e[s].text,n)}},Autocomplete.prototype._makePhoneURL=function(t){if(t.href)return t.href;var e=this.makers[t[this.MAKER_ID]]+" ";return e+=t[this.PHONE_NAME],e=e.toLowerCase().replace(/\s+|-|\/|\./g,"_"),e+="-"+t[this.PHONE_ID]+".php",e},Autocomplete.prototype._makeCompareURL=function(t){var e=window.location.search;return e||(e="?"),e=e.replace(new RegExp("&?idPhone"+this.position+"=\\d+"),""),"?"!=e.charAt(e.length-1)&&(e+="&"),e+="idPhone"+this.position+"=",e+=t.id||t[this.PHONE_ID],window.location.pathname+e+window.location.hash},Autocomplete.prototype.makePhone=function(t){return{href:this.full?this._makePhoneURL(t):this._makeCompareURL(t),src:t.src||AUTOCOMPLETE_THUMB_URL+t[this.THUMB],text:t.text||this.makers[t[this.MAKER_ID]]+" "+t[this.PHONE_NAME]}},Autocomplete.prototype._makeSearchName=function(t){const e=this.makers[t[this.MAKER_ID]],s=e+" "+t[this.PHONE_NAME];return s.toLowerCase()},Autocomplete.prototype._makeSearchString=function(t){const e=this.makers[t[this.MAKER_ID]],s=e+" "+t[this.SEARCH_STR];return s.toLowerCase()},Autocomplete.prototype.searchPhones=function(){function t(t){return t.replace(/^\s*(.*?)\s*$/,"$1")}function e(t){return t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&")}function s(t,e){for(var s=0;s<t.length;s++)if(!e.match(t[s]))return!1;return!0}const i=t(this.field.value).toLowerCase();if(0==i.length)return void this.showRecentPhones();if(!this.list)return;const o=i.split(/\s+/g),n=[],h=[];for(var a=0;a<o.length;a++){const t=e(o[a]),s=t.match(/^\w/),i=t.match(/\w$/);n.push(new RegExp((s?"\\b":"")+t)),h.push(new RegExp((s?"\\b":"")+t+(i?"\\b":"")))}this.phoneLabel.innerHTML="Devices",$gsm.removeClass(this.phonesList,"autocomplete-last-searched"),this.phonesMoreLi.style.display="",this.show();const l=[];for(let t=0;t<this.list.length;t++){const e=this.list[t],i=this._makeSearchName(e),o=this._makeSearchString(e);if((s(n,i)||o&&s(h,o))&&l.push(this.makePhone(e)),l.length>=AUTOCOMPLETE_MAX_LINES)break}this.setList(this.phonesList,l)},Autocomplete.prototype.searchNewsAndReviews=function(){if(!this.full)return;this.setList(this.newsList,[]),this.setList(this.reviewsList,[]);const t=this.field.value,e=NEWS_REVIEWS_URL+"?sSearch="+encodeURIComponent(t);t.length<AUTOCOMPLETE_NEWS_REVIEWS_MIN_LENGTH||(clearTimeout(this.newsReviewsTimeout),this.newsReviewsTimeout=setTimeout(function(){t.length>=1&&$gsm.xhr("GET",e,function(t){0!=this.field.value.length&&($gsm.addClass(this.div,"autocomplete-large"),$gsm.removeClass(this.div,"autocomplete-small"),t.news.splice(AUTOCOMPLETE_MAX_LINES),t.reviews.splice(AUTOCOMPLETE_MAX_LINES),this.setList(this.newsList,t.news),this.setList(this.reviewsList,t.reviews))}.bind(this))}.bind(this),AUTOCOMPLETE_NEWS_REVIEWS_TIMEOUT))},Autocomplete.prototype.showRecentPhones=function(t){this.loadRecentPhones();const e=AUTOCOMPLETE_GLOBAL_DATA[this.globalDataName].recent,s=[];for(var i=0;i<Math.min(e.length,AUTOCOMPLETE_MAX_LINES);i++)("function"!=typeof t||t(e[i]))&&s.push(this.makePhone(e[i]));0!=s.length&&(this.setList(this.phonesList,s),this.phoneLabel.innerHTML="Last visited",$gsm.addClass(this.phonesList,"autocomplete-last-searched"),$gsm.removeClass(this.div,"autocomplete-large"),$gsm.addClass(this.div,"autocomplete-small"),this.phonesMoreLi.style.display="none",this.show())},Autocomplete.prototype.hide=function(){$gsm.addClass(this.div,"autocomplete-hide"),this.searchButtons&&(this.searchButtons.style.display="none"),!this.position&&this.quickSearchButton&&(this.quickSearchButton.style.display="")},Autocomplete.prototype.show=function(){$gsm.removeClass(this.div,"autocomplete-hide"),this.searchButtons&&(this.searchButtons.style.display="initial"),!this.position&&this.quickSearchButton&&(this.quickSearchButton.style.display="none")};